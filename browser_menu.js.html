<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>browser/menu.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-browser_contextmenu.html">browser/contextmenu</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenu.html#.addTippy">addTippy</a></li></ul></li><li><a href="module-browser_filter-Filter.html">Filter</a><ul class='methods'><li data-type='method'><a href="module-browser_filter-Filter.html#setVisible">setVisible</a></li><li data-type='method'><a href="module-browser_filter-Filter.html#toString">toString</a></li></ul></li><li><a href="module-browser_menu.Menu.html">Menu</a><ul class='methods'><li data-type='method'><a href="module-browser_menu.Menu.html#.about">about</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#.closeListener">closeListener</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#.visualizationFeedback">visualizationFeedback</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#addMenu">addMenu</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#addOptions">addOptions</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#menuData">menuData</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#optionsFromJSON">optionsFromJSON</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#optionsToJSON">optionsToJSON</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#separateSubs">separateSubs</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#setLanguage">setLanguage</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#showCloseMatches">showCloseMatches</a></li></ul></li><li><a href="module-browser_search.html">browser/search</a><ul class='methods'><li data-type='method'><a href="module-browser_search.html#search">search</a></li><li data-type='method'><a href="module-browser_search.html#showSearch">showSearch</a></li><li data-type='method'><a href="module-browser_search.html#showSearchResults">showSearchResults</a></li></ul></li><li><a href="module-browser_view.View.html">View</a><ul class='methods'><li data-type='method'><a href="module-browser_view.View.html#fill">fill</a></li></ul></li><li><a href="module-graph.Graph.html">Graph</a><ul class='methods'><li data-type='method'><a href="module-graph.Graph.html#.setVisible">setVisible</a></li><li data-type='method'><a href="module-graph.Graph.html#.starStyle">starStyle</a></li><li data-type='method'><a href="module-graph.Graph.html#assimilate">assimilate</a></li><li data-type='method'><a href="module-graph.Graph.html#combineMatch">combineMatch</a></li><li data-type='method'><a href="module-graph.Graph.html#createRemoveIssue">createRemoveIssue</a></li><li data-type='method'><a href="module-graph.Graph.html#cumulativeSearch">cumulativeSearch</a></li><li data-type='method'><a href="module-graph.Graph.html#getElementsByIds">getElementsByIds</a></li><li data-type='method'><a href="module-graph.Graph.html#getSource">getSource</a></li><li data-type='method'><a href="module-graph.Graph.html#invert">invert</a></li><li data-type='method'><a href="module-graph.Graph.html#moveAllMatches">moveAllMatches</a></li><li data-type='method'><a href="module-graph.Graph.html#moveNodes">moveNodes</a></li><li data-type='method'><a href="module-graph.Graph.html#multiplex">multiplex</a></li><li data-type='method'><a href="module-graph.Graph.html#newGraph">newGraph</a></li><li data-type='method'><a href="module-graph.Graph.html#presentUri">presentUri</a></li><li data-type='method'><a href="module-graph.Graph.html#presentUris">presentUris</a></li><li data-type='method'><a href="module-graph.Graph.html#resetStyle">resetStyle</a></li><li data-type='method'><a href="module-graph.Graph.html#setSource">setSource</a></li><li data-type='method'><a href="module-graph.Graph.html#showCloseMatch">showCloseMatch</a></li><li data-type='method'><a href="module-graph.Graph.html#showDoubleStar">showDoubleStar</a></li><li data-type='method'><a href="module-graph.Graph.html#showPath">showPath</a></li><li data-type='method'><a href="module-graph.Graph.html#showStar">showStar</a></li><li data-type='method'><a href="module-graph.Graph.html#showStarMultiplexed">showStarMultiplexed</a></li><li data-type='method'><a href="module-graph.Graph.html#showStarMultiplexedNew">showStarMultiplexedNew</a></li><li data-type='method'><a href="module-graph.Graph.html#showWorm">showWorm</a></li><li data-type='method'><a href="module-graph.Graph.html#subOntologyConnectivity">subOntologyConnectivity</a></li></ul></li><li><a href="module-property.Property.html">Property</a></li></ul><h3>Modules</h3><ul><li><a href="config.module_dist.html">dist</a></li><li><a href="module-browser_benchmark.html">browser/benchmark</a><ul class='methods'><li data-type='method'><a href="module-browser_benchmark.html#.addOverlay">addOverlay</a></li></ul></li><li><a href="module-browser_chaptersearch.html">browser/chaptersearch</a><ul class='methods'><li data-type='method'><a href="module-browser_chaptersearch.html#.showChapterSearch">showChapterSearch</a></li><li data-type='method'><a href="module-browser_chaptersearch.html#~getClasses">getClasses</a></li><li data-type='method'><a href="module-browser_chaptersearch.html#~showClasses">showClasses</a></li></ul></li><li><a href="module-browser_classuse.html">browser/classuse</a></li><li><a href="module-browser_colorschemeday.html">browser/colorschemeday</a></li><li><a href="module-browser_colorschemenight.html">browser/colorschemenight</a></li><li><a href="module-browser_contextmenu.html">browser/contextmenu</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenu.html#.addTippy">addTippy</a></li></ul></li><li><a href="module-browser_contextmenuEdges.html">browser/contextmenuEdges</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenuEdges.html#~edgeLabel">edgeLabel</a></li></ul></li><li><a href="module-browser_contextmenuNodes.html">browser/contextmenuNodes</a></li><li><a href="module-browser_filter.html">browser/filter</a><ul class='methods'><li data-type='method'><a href="module-browser_filter.html#.addFilterEntries">addFilterEntries</a></li><li data-type='method'><a href="module-browser_filter.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="module-browser_filter.html#.toJSON">toJSON</a></li></ul></li><li><a href="module-browser_load.html">browser/load</a><ul class='methods'><li data-type='method'><a href="module-browser_load.html#.addFileLoadEntries">addFileLoadEntries</a></li><li data-type='method'><a href="module-browser_load.html#.loadSessionFromJsonFile">loadSessionFromJsonFile</a></li><li data-type='method'><a href="module-browser_load.html#.loadView">loadView</a></li><li data-type='method'><a href="module-browser_load.html#~addLoadEntry">addLoadEntry</a></li><li data-type='method'><a href="module-browser_load.html#~loadGraphFromJson">loadGraphFromJson</a></li><li data-type='method'><a href="module-browser_load.html#~uploadJson">uploadJson</a></li></ul></li><li><a href="module-browser_log.html">browser/log</a></li><li><a href="module-browser_main.html">browser/main</a><ul class='methods'><li data-type='method'><a href="module-browser_main.html#.fillInitialGraph">fillInitialGraph</a></li><li data-type='method'><a href="module-browser_main.html#~applyParams">applyParams</a></li><li data-type='method'><a href="module-browser_main.html#~initKeyListener">initKeyListener</a></li><li data-type='method'><a href="module-browser_main.html#~main">main</a></li><li data-type='method'><a href="module-browser_main.html#~parseParams">parseParams</a></li></ul></li><li><a href="module-browser_menu.html">browser/menu</a></li><li><a href="module-browser_progress.html">browser/progress</a></li><li><a href="module-browser_save.html">browser/save</a><ul class='methods'><li data-type='method'><a href="module-browser_save.html#.saveGraph">saveGraph</a></li><li data-type='method'><a href="module-browser_save.html#.saveJson">saveJson</a></li><li data-type='method'><a href="module-browser_save.html#.savePng">savePng</a></li><li data-type='method'><a href="module-browser_save.html#.saveSession">saveSession</a></li><li data-type='method'><a href="module-browser_save.html#.saveSvg">saveSvg</a></li><li data-type='method'><a href="module-browser_save.html#.saveUrl">saveUrl</a></li><li data-type='method'><a href="module-browser_save.html#.saveView">saveView</a></li><li data-type='method'><a href="module-browser_save.html#~stringify">stringify</a></li></ul></li><li><a href="module-browser_search.html">browser/search</a><ul class='methods'><li data-type='method'><a href="module-browser_search.html#search">search</a></li><li data-type='method'><a href="module-browser_search.html#showSearch">showSearch</a></li><li data-type='method'><a href="module-browser_search.html#showSearchResults">showSearchResults</a></li></ul></li><li><a href="module-browser_state.html">browser/state</a><ul class='methods'><li data-type='method'><a href="module-browser_state.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="module-browser_state.html#.toJSON">toJSON</a></li></ul></li><li><a href="module-browser_style.html">browser/style</a></li><li><a href="module-browser_teststyle.html">browser/teststyle</a></li><li><a href="module-browser_util.html">browser/util</a><ul class='methods'><li data-type='method'><a href="module-browser_util.html#.checkboxClickableDiv">checkboxClickableDiv</a></li><li data-type='method'><a href="module-browser_util.html#.createGitHubIssue">createGitHubIssue</a></li><li data-type='method'><a href="module-browser_util.html#.getElementById">getElementById</a></li></ul></li><li><a href="module-browser_view.html">browser/view</a><ul class='methods'><li data-type='method'><a href="module-browser_view.html#.activeState">activeState</a></li><li data-type='method'><a href="module-browser_view.html#.activeView">activeView</a></li><li data-type='method'><a href="module-browser_view.html#.reset">reset</a></li><li data-type='method'><a href="module-browser_view.html#~traverse">traverse</a></li></ul></li><li><a href="module-browser_viewLayout.html">browser/viewLayout</a><ul class='methods'><li data-type='method'><a href="module-browser_viewLayout.html#.goldenLayout">goldenLayout</a></li></ul></li><li><a href="module-edge.html">edge</a></li><li><a href="module-fuse.html">fuse</a><ul class='methods'><li data-type='method'><a href="module-fuse.html#.createIndex">createIndex</a></li><li data-type='method'><a href="module-fuse.html#.search">search</a></li></ul></li><li><a href="module-graph.html">graph</a></li><li><a href="module-lang_language.html">lang/language</a><ul class='methods'><li data-type='method'><a href="module-lang_language.html#.getIdStrings">getIdStrings</a></li><li data-type='method'><a href="module-lang_language.html#.getLanguage">getLanguage</a></li><li data-type='method'><a href="module-lang_language.html#.getString">getString</a></li><li data-type='method'><a href="module-lang_language.html#.setLanguage">setLanguage</a></li><li data-type='method'><a href="module-lang_language.html#.updateHtml">updateHtml</a></li></ul></li><li><a href="module-layout.html">layout</a><ul class='methods'><li data-type='method'><a href="module-layout.html#.positions">positions</a></li><li data-type='method'><a href="module-layout.html#.presetLayout">presetLayout</a></li><li data-type='method'><a href="module-layout.html#.run">run</a></li><li data-type='method'><a href="module-layout.html#.runCached">runCached</a></li><li data-type='method'><a href="module-layout.html#~center">center</a></li><li data-type='method'><a href="module-layout.html#~springLength">springLength</a></li><li data-type='method'><a href="module-layout.html#~storageName">storageName</a></li></ul></li><li><a href="module-loadGraphFromSparql.html">loadGraphFromSparql</a><ul class='methods'><li data-type='method'><a href="module-loadGraphFromSparql.html#~createClassNodes">createClassNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createEdges">createEdges</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createInstanceNodes">createInstanceNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createNodes">createNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~parseLabels">parseLabels</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectClasses">selectClasses</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectInstances">selectInstances</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectTriples">selectTriples</a></li></ul></li><li><a href="module-node.html">node</a></li><li><a href="module-property.html">property</a><ul class='methods'><li data-type='method'><a href="module-property.html#.possible">possible</a></li></ul></li><li><a href="module-rdf.html">rdf</a><ul class='methods'><li data-type='method'><a href="module-rdf.html#.long">long</a></li><li data-type='method'><a href="module-rdf.html#.longPrefix">longPrefix</a></li><li data-type='method'><a href="module-rdf.html#.short">short</a></li><li data-type='method'><a href="module-rdf.html#.sub">sub</a></li></ul></li><li><a href="module-sparql.html">sparql</a><ul class='methods'><li data-type='method'><a href="module-sparql.html#.ask">ask</a></li><li data-type='method'><a href="module-sparql.html#.describe">describe</a></li><li data-type='method'><a href="module-sparql.html#.select">select</a></li></ul></li><li><a href="module-string.html">string</a><ul class='methods'><li data-type='method'><a href="module-string.html#.abbrv">abbrv</a></li></ul></li><li><a href="module-timer.html">timer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#browserCheckNonTranspiled">browserCheckNonTranspiled</a></li><li><a href="global.html#browserCheckTranspiled">browserCheckTranspiled</a></li><li><a href="global.html#flatten">flatten</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#logWrap">logWrap</a></li><li><a href="global.html#menuDefaults">menuDefaults</a></li><li><a href="global.html#sayswho">sayswho</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">browser/menu.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** Populates the menu bar on the top and initializes the context menu.*/
/**
@module */
import * as save from "./save.js";
import * as layout from "../layout.js";
import * as NODE from "../node.js";
import loadGraphFromSparql from "../loadGraphFromSparql.js";
import * as language from "../lang/language.js";
import * as util from "./util.js";
import config from "../config.js";
import progress from "./progress.js";
import { showChapterSearch } from "./chaptersearch.js";
import { addFilterEntries } from "./filter.js";
import * as load from "./load.js";
import { Graph } from "./graph.js";
import { activeState, activeView, mainView, views } from "./view.js";

export let menu = null; // singleton instance

/** main menu bar */
export class Menu {
	/** Construct the main menu bar for the given graph. */
	constructor() {
		if (menu) {
			throw Error("Menu already exists.");
		}
		document.body.addEventListener("click", Menu.closeListener);
		// bind this to the class instance instead of the event source
		this.showCloseMatches = this.showCloseMatches.bind(this);
		this.addMenu();
		menu = this;
	}

	/** @return {boolean} whether subontologies are to be displayed separately. */
	separateSubs() {
		return this.separateSubsBox.checked;
	}

	///** @return {boolean} whether star operations should be shown in a new view. */
	// starNewView() {return this.starNewViewBox.checked;}

	/** Sets the preferred node label language attribute. Use the values from node.js.
	 * @param {string} lang the language to set
	 * @return {void} */
	setLanguage(lang) {
		if (!language.setLanguage(lang)) {
			return;
		}
		language.updateHtml();
		// this.graph.cy.style(style); // does not display the style correctly and doesn't update the labels
		// this.graph.cy.forceRender(); // does not update the labels either
		// the nuclear option works
		for (const view of views()) {
			const elements = view.state.graph.cy.elements();
			view.state.graph.cy.remove(elements);
			elements.restore();
		}
	}

	/** Notifies the user of the program version so that errors can be properly reported.
	 * @return {void} */
	static about() {
		window.alert("SNIK Graph version " + util.VERSION);
	}

	/** Creates a GitHub issue for the visualization.
	 *  @return {void} */
	static visualizationFeedback() {
		util.createGitHubIssue(
			util.REPO_APPLICATION,
			"",
			"Please type your issue here:\n\n\n\n" + "!!Please do not delete the following text, because its the log for developers!!\n\n",
			log.logs
		);
	}

	/** Show all nodes that are connected via close matches to visible nodes.
	 *  @return {void} */
	showCloseMatches() {
		log.debug("show close matches start");
		const visible = activeState().graph.cy.elements(".unfiltered").not(".hidden");
		//const closeMatchEdges = this.graph.cy.edges('[pl="closeMatch"]');
		const newEdges = visible.connectedEdges(".unfiltered").filter('[pl="closeMatch"]');
		Graph.setVisible(newEdges, true);
		Graph.setVisible(newEdges.connectedNodes(".unfiltered"), true);
		log.debug("show close matches end");
		//closeMatchEdges.connectedNodes();
		//".unfiltered";
	}

	/**
  Creates and returns the menus for the top menu bar.
  The format is an array of menu elements.
  Each menu element is an object with a "label", unique "id" and an "entries" array.
  entries is an array of arrays of size two.
  entries[i][0] is either a link as a string (will be opened on another tab) or a function that will be executed.
  entries[i][1] is a label as a string.
  * @return {Object} the array of menu elements.
  */
	menuData() {
		return [
			{
				label: "File",
				i18n: "file",
				id: "file",
				entries: [
					[
						async () => {
							await loadGraphFromSparql(this.graph.cy, []);
							progress(() => layout.runCached(this.graph.cy, layout.euler, config.defaultSubOntologies, this.separateSubs()));
						},
						"Load from SPARQL Endpoint",
						"load-sparql",
					],
					[() => save.saveSession(this.optionsToJSON()), "Save Session", "save-session"],
					[() => save.saveGraph(activeState().graph), "Save the full SNIK Graph", "save-snik-graph"],
					[() => save.saveView(activeView()), "Save currently active view (partial graph)", "save-view"],
					[
						() => {
							progress(() => layout.run(activeState().cy, layout.euler, config.defaultSubOntologies, this.separateSubs(), true));
						},
						"Recalculate Layout and Replace in Browser Cache",
						"recalculate-layout-replace",
					],
					[() => save.savePng(activeState().graph, this.dayModeBox.checked, false, false), "Save Image of Current View", "save-image-current-view"],
					[() => save.savePng(activeState().graph, this.dayModeBox.checked, true, false), "Save Image of Whole Graph", "save-image-whole-graph"],
					[
						() => save.savePng(activeState().graph, this.dayModeBox.checked, false, true),
						"Save Image of Current View (high res)",
						"save-image-current-view-high-res",
					],
					[
						() => save.savePng(activeState().graph, this.dayModeBox.checked, true, true),
						"Save Image of Whole Graph (high res)",
						"save-image-whole-graph-high-res",
					],
					[() => save.saveSvg(activeState().graph, this.dayModeBox.checked, true), "Save Image of Whole Graph (SVG)"],
				],
			},
			{
				label: "Filter",
				i18n: "filter",
				id: "filter",
				entries: [], // filled by addFilterEntries() from filter.js
			},
			{
				label: "Options",
				i18n: "options",
				id: "options",
				entries: [], // filled by addOptions()
			},
			{
				label: "Layout",
				i18n: "layout",
				entries: [
					[this.showCloseMatches, "show close matches", "show-close-matches"],
					[
						() => {
							layout.run(activeState().graph.cy, layout.euler, config.defaultSubOntologies, this.separateSubs() &amp;&amp; !activeState().graph.getStarMode(), true);
						},
						"recalculate layout",
						"recalculate-layout",
						"ctrl+alt+l",
					],
					[
						() => {
							layout.run(
								activeState().graph.cy,
								layout.eulerTight,
								config.defaultSubOntologies,
								this.separateSubs() &amp;&amp; !activeState().graph.getStarMode(),
								false
							);
						},
						"tight layout",
						"tight-layout",
						"ctrl+alt+t",
					],
					[
						() => {
							layout.run(activeState().graph.cy, layout.cose, config.defaultSubOntologies, this.separateSubs() &amp;&amp; !activeState().graph.getStarMode(), false);
						},
						"compound layout",
						"compound-layout",
						"ctrl+alt+c",
					],
					[() => activeState().graph.moveAllMatches(0), "move matches on top of each other", "move-match-on-top"],
					[() => activeState().graph.moveAllMatches(100), "move matches nearby", "move-match-nearby"],
					[
						() => {
							showChapterSearch("bb");
						},
						"BB chapter search",
						"bb-chapter-search",
					],
					[
						() => {
							showChapterSearch("ob");
						},
						"OB chapter search",
						"ob-chapter-search",
					],
					[activeState().graph.subOntologyConnectivity, "subontology connectivity", "subontology-connectivity"],
					[mainView.state.graph.resetStyle, "reset main view", "reset-view", "ctrl+alt+r"],
					[
						() => {
							activeView().setTitle(prompt("Rename: " + activeView().config.title) || activeView().config.title);
							activeState().title = activeView().config.title;
						},
						"change title of active View",
						"change-title",
					],
				],
			},
			{
				label: "Services",
				i18n: "services",
				entries: [
					["http://www.snik.eu/sparql", "SPARQL Endpoint", "sparql-endpoint"],
					["http://www.snik.eu/ontology", "RDF Browser", "rdf-browser"],
					//["http://snik.eu/evaluation","Data Quality Evaluation","data-quality-evaluation"],
				],
			},
			{
				label: "Language",
				i18n: "language",
				entries: [
					[() => this.setLanguage(NODE.LABEL_ENGLISH), "english", "english"],
					[() => this.setLanguage(NODE.LABEL_GERMAN), "german", "german"],
					[() => this.setLanguage(NODE.LABEL_PERSIAN), "persian", "persian"],
				],
			},
			{
				label: "Help",
				i18n: "help",
				entries: [
					["manual.html", "Manual"],
					["https://www.snik.eu/sites/www.snik.eu/files/files/uploads/Einfuehrung/snik-tutorial.pdf", "Tutorial"],
					["layoutHelp.html", "Layout Help"],
					["https://imise.github.io/snik-cytoscape.js/", "Developer Documentation"],
					["https://www.youtube.com/channel/UCV8wbTpOdHurbaHqP0sAOng/featured", "YouTube Channel"],
					["troubleshooting.html", "Troubleshooting"],
					["contribute.html", "Contribute"],
					["https://www.snik.eu/", "Project Homepage"],
					["https://www.snik.eu/sites/www.snik.eu/files/files/uploads/Ergebnisse/SNIK_Metamodell_V8.png", "SNIK Meta Model"],
					[Menu.about, "About SNIK Graph"],
					["https://github.com/IMISE/snik-ontology/issues", "Submit Feedback about the Ontology"],
					[Menu.visualizationFeedback, "Submit Feedback about the Visualization"],
				],
			},
		];
	}

	/**
	 * Add the menu entries of the options menu. Cannot be done with an entries array because they need an event listener so they have its own function.
	 * @param {Array&lt;HTMLAnchorElement>} as an empty array that will be filled with the anchor elements
	 * @return {void} */
	addOptions(as) {
		const optionsContent = util.getElementById("options-menu-content");
		const names = ["separateSubs", "cumulativeSearch", "grid", "combineMatchMode", "dayMode", "devMode", "extMode"]; // ,"starNewView"
		this.optionBoxes = {};
		for (const name of names) {
			log.trace("Add option " + name);
			const a = document.createElement("a");
			as.push(a);
			optionsContent.appendChild(a);
			a.setAttribute("tabindex", -1);
			a.classList.add("dropdown-entry");

			const box = document.createElement("input");
			this.optionBoxes[name] = box;
			a.appendChild(box);
			box.type = "checkbox";
			box.autocomplete = "off";
			this[name + "Box"] = box;
			box.id = name + "Box";

			a.addEventListener("keydown", util.checkboxKeydownListener(box));
			a.appendChild(util.checkboxClickableDiv(box, language.getString(name), name));
		}

		this.separateSubsBox.addEventListener("change", () => {
			log.debug("Set separate Subontologies to " + this.separateSubsBox.checked);
		});
		this.dayModeBox.addEventListener("change", () => {
			for (const view of views()) {
				view.state.graph.invert(this.dayModeBox.checked);
			}
			log.debug("Set dayMode to " + this.dayModeBox.checked);
		});
		this.gridBox.addEventListener("change", () => {
			document.body.classList[this.gridBox.checked ? "add" : "remove"]("grid");
			log.debug("set gridBox to " + this.gridBox.checked);
		});
		if (config.activeOptions.includes("day")) {
			this.dayModeBox.click();
		}
		if (config.activeOptions.includes("ext")) {
			this.extModeBox.click();
		}
		if (config.activeOptions.includes("dev")) {
			this.devModeBox.click();
		}
		/** @type {HTMLInputElement} */
		// is only used by the main tab
		this.cumulativeSearchBox.addEventListener("change", () => {
			log.debug("Set cumulative search to " + this.cumulativeSearchBox.checked);
		});
		/** @type {HTMLInputElement} */
		this.combineMatchModeBox.addEventListener("change", () => {
			// Combine matches is *not* active in a new tab if the user first copies, then turns combine matches on and finally pastes.
			// In this case, "combine matches" needs to be deactivated and activated again to take effect on the paste result.
			log.debug("Set combine match mode to " + this.combineMatchModeBox.checked);
			// give the browser time to update the checkbox, see https://stackoverflow.com/questions/64442639/how-to-give-instant-user-feedback-on-slow-checkbox-listeners-in-javascript?noredirect=1#comment113950377_64442639
			setTimeout(() => {
				views()
					.map((v) => v.state.graph)
					.forEach((graph) => graph.combineMatch(this.combineMatchModeBox.checked));
			}, 10);
		});
	}

	/** Adds the menu to the graph parent DOM element and sets up the event listeners.
	 *  @return {void} */
	addMenu() {
		console.groupCollapsed("Add menu");
		//const frag = new DocumentFragment();
		const ul = document.createElement("ul");
		//this.graph.parent.prepend(ul); // for multiple graphs at the same time with a menu each
		util.getElementById("top").prepend(ul); // a single menu for a single graph
		ul.classList.add("dropdown-bar");
		// see https://developer.mozilla.org/en-US/docs/Web/Accessibility/Keyboard-navigable_JavaScript_widgets
		ul.setAttribute("tabindex", "0");

		const data = this.menuData();
		const spans = [];
		const aas = []; // 2-dimensional array of anchors

		for (let i = 0; i &lt; data.length; i++) {
			const menuDatum = data[i];
			const li = document.createElement("li");
			li.setAttribute("tabindex", "-1");
			ul.appendChild(li);

			const span = document.createElement("span");
			spans.push(span);
			li.appendChild(span);
			span.classList.add("dropdown-menu");
			span.innerText = menuDatum.label;
			span.setAttribute("data-i18n", menuDatum.i18n);
			span.setAttribute("tabindex", "-1");

			const div = document.createElement("div");
			li.appendChild(div);
			div.classList.add("dropdown-content");
			div.setAttribute("tabindex", "-1");
			if (menuDatum.id) {
				div.id = menuDatum.id + "-menu-content";
			}

			span.addEventListener("click", () => {
				for (const otherDiv of document.getElementsByClassName("dropdown-content")) {
					if (div !== otherDiv) {
						otherDiv.classList.remove("show");
					}
				}
				div.classList.toggle("show");
			});

			const as = [];
			aas.push(as);

			for (const entry of menuDatum.entries) {
				const a = document.createElement("a");
				as.push(a);
				a.classList.add("dropdown-entry");
				a.setAttribute("data-i18n", entry[2]);
				a.setAttribute("tabindex", "-1");
				div.appendChild(a);
				a.innerHTML = entry[1];
				switch (typeof entry[0]) {
					case "string": {
						a.href = entry[0];
						a.target = "_blank";
						break;
					}
					case "function": {
						a.addEventListener("click", entry[0]);
						// we only use hotkeys for functions
						const hotkey = entry[3];
						if (hotkey) {
							hotkeys(hotkey, entry[0]);
							a.innerHTML = a.innerHTML + ` (${hotkey.toUpperCase()})`;
						}
						break;
					}
					default:
						log.error("unknown menu entry action type: " + typeof entry[0]);
				}
			}
			span.addEventListener("keydown", (event) => {
				switch (event.key) {
					case "ArrowLeft":
						spans[(i - 1 + spans.length) % spans.length].focus(); // positive modulo
						spans[(i - 1 + spans.length) % spans.length].click();
						break;
					case "ArrowRight":
						spans[(i + 1) % spans.length].focus();
						spans[(i + 1) % spans.length].click();
						break;
					case "ArrowDown":
						as[0].focus();
						break;
				}
			});
		}

		load.addFileLoadEntries(activeState().graph, util.getElementById("file-menu-content"), aas[0], this.optionsFromJSON); // update index when "File" position changes in the menu
		log.debug("fileLoadEntries added");

		addFilterEntries(util.getElementById("filter-menu-content"), aas[1]); // update index when "Filter" position changes in the menu
		log.debug("filter entries added");

		this.addOptions(aas[2]); // update index when "Options" position changes in the menu

		for (let i = 0; i &lt; aas.length; i++) {
			const as = aas[i];
			for (let j = 0; j &lt; as.length; j++) {
				as[j].addEventListener("keydown", (event) => {
					switch (event.key) {
						case "ArrowLeft":
							spans[(i - 1 + spans.length) % spans.length].focus(); // positive modulo
							spans[(i - 1 + spans.length) % spans.length].click();
							break;
						case "ArrowRight":
							spans[(i + 1) % spans.length].focus();
							spans[(i + 1) % spans.length].click();
							break;
						case "ArrowUp":
							as[(j - 1 + as.length) % as.length].focus();
							break;
						case "ArrowDown":
							as[(j + 1) % as.length].focus();
							break;
					}
				});
			}
		}

		// fix mouse position after container change, see https://stackoverflow.com/questions/23461322/cytoscape-js-wrong-mouse-pointer-position-after-container-change
		//this.graph.cy.resize();
		log.debug("Menu added");
		console.groupEnd();
	}

	/** Close the dropdown if the user clicks outside of the menu.
	 *  @param {Event} e a click event
	 *  @return {void} */
	static closeListener(e) {
		if (
			e &amp;&amp;
			e.target &amp;&amp;
			e.target.matches &amp;&amp;
			!e.target.matches(".dropdown-entry") &amp;&amp;
			!e.target.matches(".dropdown-menu") &amp;&amp;
			!e.target.matches("input.filterbox")
		) {
			// don't close while user edits the text field of the custom filter
			const dropdowns = document.getElementsByClassName("dropdown-content");
			Array.from(dropdowns).forEach((d) => d.classList.remove("show"));
		}
	}

	/** Save session-based options (not user preferences) to JSON.
	 *  @return {void} */
	optionsToJSON() {
		const sessionOptions = ["separateSubs", "cumulativeSearch", "grid", "combineMatchMode", "dayMode", "devMode", "extMode"];
		const options = {};
		for (const option of sessionOptions) {
			options[option] = this.optionBoxes[option].checked;
		}
		return options;
	}

	/** Restore session-based options from the output of toJSON().
	 *  @param {object} json an option object
	 *  @return {void} */
	optionsFromJSON(json) {
		const currentOptions = this.optionsToJSON();
		for (const [name, checked] of Object.entries(json)) {
			if (currentOptions[name] !== checked) {
				this.optionBoxes[name].click();
			}
		}
	}
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Wed Aug 25 2021 11:31:19 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
