<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>browser/filter.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-browser_contextmenu.html">browser/contextmenu</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenu.html#.addTippy">addTippy</a></li><li data-type='method'><a href="module-browser_contextmenu.html#populate">populate</a></li><li data-type='method'><a href="module-browser_contextmenu.html#reset">reset</a></li></ul></li><li><a href="module-browser_contextmenuEdges.html">browser/contextmenuEdges</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseLimesMenu">baseLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseMenu">baseMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devLimesMenu">devLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devMenu">devMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#baseCommands">baseCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#devCommands">devCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#edgeLabel">edgeLabel</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#limesCommands">limesCommands</a></li></ul></li><li><a href="module-browser_filter-Filter.html">Filter</a><ul class='methods'><li data-type='method'><a href="module-browser_filter-Filter.html#setVisible">setVisible</a></li><li data-type='method'><a href="module-browser_filter-Filter.html#toString">toString</a></li></ul></li><li><a href="module-browser_menu.Menu.html">Menu</a><ul class='methods'><li data-type='method'><a href="module-browser_menu.Menu.html#.about">about</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#.closeListener">closeListener</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#.visualizationFeedback">visualizationFeedback</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#addMenu">addMenu</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#addOptions">addOptions</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#menuData">menuData</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#optionsFromJSON">optionsFromJSON</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#optionsToJSON">optionsToJSON</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#separateSubs">separateSubs</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#setLanguage">setLanguage</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#showCloseMatches">showCloseMatches</a></li></ul></li><li><a href="module-browser_search.html">browser/search</a><ul class='methods'><li data-type='method'><a href="module-browser_search.html#search">search</a></li><li data-type='method'><a href="module-browser_search.html#showSearch">showSearch</a></li><li data-type='method'><a href="module-browser_search.html#showSearchResults">showSearchResults</a></li></ul></li><li><a href="module-browser_view.View.html">View</a><ul class='methods'><li data-type='method'><a href="module-browser_view.View.html#fill">fill</a></li></ul></li><li><a href="module-graph.Graph.html">Graph</a><ul class='methods'><li data-type='method'><a href="module-graph.Graph.html#.setVisible">setVisible</a></li><li data-type='method'><a href="module-graph.Graph.html#.starStyle">starStyle</a></li><li data-type='method'><a href="module-graph.Graph.html#assimilate">assimilate</a></li><li data-type='method'><a href="module-graph.Graph.html#combineMatch">combineMatch</a></li><li data-type='method'><a href="module-graph.Graph.html#createRemoveIssue">createRemoveIssue</a></li><li data-type='method'><a href="module-graph.Graph.html#cumulativeSearch">cumulativeSearch</a></li><li data-type='method'><a href="module-graph.Graph.html#getElementsByIds">getElementsByIds</a></li><li data-type='method'><a href="module-graph.Graph.html#getSource">getSource</a></li><li data-type='method'><a href="module-graph.Graph.html#invert">invert</a></li><li data-type='method'><a href="module-graph.Graph.html#moveAllMatches">moveAllMatches</a></li><li data-type='method'><a href="module-graph.Graph.html#moveNodes">moveNodes</a></li><li data-type='method'><a href="module-graph.Graph.html#multiplex">multiplex</a></li><li data-type='method'><a href="module-graph.Graph.html#newGraph">newGraph</a></li><li data-type='method'><a href="module-graph.Graph.html#presentUri">presentUri</a></li><li data-type='method'><a href="module-graph.Graph.html#presentUris">presentUris</a></li><li data-type='method'><a href="module-graph.Graph.html#resetStyle">resetStyle</a></li><li data-type='method'><a href="module-graph.Graph.html#setSource">setSource</a></li><li data-type='method'><a href="module-graph.Graph.html#showCloseMatch">showCloseMatch</a></li><li data-type='method'><a href="module-graph.Graph.html#showDoubleStar">showDoubleStar</a></li><li data-type='method'><a href="module-graph.Graph.html#showPath">showPath</a></li><li data-type='method'><a href="module-graph.Graph.html#showStar">showStar</a></li><li data-type='method'><a href="module-graph.Graph.html#showStarMultiplexed">showStarMultiplexed</a></li><li data-type='method'><a href="module-graph.Graph.html#showStarMultiplexedNew">showStarMultiplexedNew</a></li><li data-type='method'><a href="module-graph.Graph.html#showWorm">showWorm</a></li><li data-type='method'><a href="module-graph.Graph.html#subOntologyConnectivity">subOntologyConnectivity</a></li></ul></li><li><a href="module-property.Property.html">Property</a></li></ul><h3>Modules</h3><ul><li><a href="config.module_dist.html">dist</a></li><li><a href="module-browser_benchmark.html">browser/benchmark</a><ul class='methods'><li data-type='method'><a href="module-browser_benchmark.html#.addOverlay">addOverlay</a></li></ul></li><li><a href="module-browser_chaptersearch.html">browser/chaptersearch</a><ul class='methods'><li data-type='method'><a href="module-browser_chaptersearch.html#.showChapterSearch">showChapterSearch</a></li><li data-type='method'><a href="module-browser_chaptersearch.html#~getClasses">getClasses</a></li><li data-type='method'><a href="module-browser_chaptersearch.html#~showClasses">showClasses</a></li></ul></li><li><a href="module-browser_classuse.html">browser/classuse</a></li><li><a href="module-browser_colorschemeday.html">browser/colorschemeday</a></li><li><a href="module-browser_colorschemenight.html">browser/colorschemenight</a></li><li><a href="module-browser_contextmenu.html">browser/contextmenu</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenu.html#.addTippy">addTippy</a></li><li data-type='method'><a href="module-browser_contextmenu.html#populate">populate</a></li><li data-type='method'><a href="module-browser_contextmenu.html#reset">reset</a></li></ul></li><li><a href="module-browser_contextmenuEdges.html">browser/contextmenuEdges</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseLimesMenu">baseLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseMenu">baseMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devLimesMenu">devLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devMenu">devMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#baseCommands">baseCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#devCommands">devCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#edgeLabel">edgeLabel</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#limesCommands">limesCommands</a></li></ul></li><li><a href="module-browser_contextmenuNodes.html">browser/contextmenuNodes</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenuNodes.html#~baseCommands">baseCommands</a></li><li data-type='method'><a href="module-browser_contextmenuNodes.html#~devCommands">devCommands</a></li><li data-type='method'><a href="module-browser_contextmenuNodes.html#~extCommands">extCommands</a></li></ul></li><li><a href="module-browser_filter.html">browser/filter</a><ul class='methods'><li data-type='method'><a href="module-browser_filter.html#.addFilterEntries">addFilterEntries</a></li><li data-type='method'><a href="module-browser_filter.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="module-browser_filter.html#.toJSON">toJSON</a></li></ul></li><li><a href="module-browser_load.html">browser/load</a><ul class='methods'><li data-type='method'><a href="module-browser_load.html#.addFileLoadEntries">addFileLoadEntries</a></li><li data-type='method'><a href="module-browser_load.html#.loadSessionFromJsonFile">loadSessionFromJsonFile</a></li><li data-type='method'><a href="module-browser_load.html#.loadView">loadView</a></li><li data-type='method'><a href="module-browser_load.html#~addLoadEntry">addLoadEntry</a></li><li data-type='method'><a href="module-browser_load.html#~loadGraphFromJson">loadGraphFromJson</a></li><li data-type='method'><a href="module-browser_load.html#~uploadJson">uploadJson</a></li></ul></li><li><a href="module-browser_log.html">browser/log</a></li><li><a href="module-browser_main.html">browser/main</a><ul class='methods'><li data-type='method'><a href="module-browser_main.html#.fillInitialGraph">fillInitialGraph</a></li><li data-type='method'><a href="module-browser_main.html#~applyParams">applyParams</a></li><li data-type='method'><a href="module-browser_main.html#~initKeyListener">initKeyListener</a></li><li data-type='method'><a href="module-browser_main.html#~main">main</a></li><li data-type='method'><a href="module-browser_main.html#~parseParams">parseParams</a></li></ul></li><li><a href="module-browser_menu.html">browser/menu</a></li><li><a href="module-browser_progress.html">browser/progress</a></li><li><a href="module-browser_save.html">browser/save</a><ul class='methods'><li data-type='method'><a href="module-browser_save.html#.saveGraph">saveGraph</a></li><li data-type='method'><a href="module-browser_save.html#.saveJson">saveJson</a></li><li data-type='method'><a href="module-browser_save.html#.savePng">savePng</a></li><li data-type='method'><a href="module-browser_save.html#.saveSession">saveSession</a></li><li data-type='method'><a href="module-browser_save.html#.saveSvg">saveSvg</a></li><li data-type='method'><a href="module-browser_save.html#.saveUrl">saveUrl</a></li><li data-type='method'><a href="module-browser_save.html#.saveView">saveView</a></li><li data-type='method'><a href="module-browser_save.html#~stringify">stringify</a></li></ul></li><li><a href="module-browser_search.html">browser/search</a><ul class='methods'><li data-type='method'><a href="module-browser_search.html#search">search</a></li><li data-type='method'><a href="module-browser_search.html#showSearch">showSearch</a></li><li data-type='method'><a href="module-browser_search.html#showSearchResults">showSearchResults</a></li></ul></li><li><a href="module-browser_state.html">browser/state</a><ul class='methods'><li data-type='method'><a href="module-browser_state.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="module-browser_state.html#.toJSON">toJSON</a></li></ul></li><li><a href="module-browser_style.html">browser/style</a></li><li><a href="module-browser_teststyle.html">browser/teststyle</a></li><li><a href="module-browser_util.html">browser/util</a><ul class='methods'><li data-type='method'><a href="module-browser_util.html#.checkboxClickableDiv">checkboxClickableDiv</a></li><li data-type='method'><a href="module-browser_util.html#.createGitHubIssue">createGitHubIssue</a></li><li data-type='method'><a href="module-browser_util.html#.getElementById">getElementById</a></li></ul></li><li><a href="module-browser_view.html">browser/view</a><ul class='methods'><li data-type='method'><a href="module-browser_view.html#.activeState">activeState</a></li><li data-type='method'><a href="module-browser_view.html#.activeView">activeView</a></li><li data-type='method'><a href="module-browser_view.html#.reset">reset</a></li><li data-type='method'><a href="module-browser_view.html#~traverse">traverse</a></li></ul></li><li><a href="module-browser_viewLayout.html">browser/viewLayout</a><ul class='methods'><li data-type='method'><a href="module-browser_viewLayout.html#.goldenLayout">goldenLayout</a></li></ul></li><li><a href="module-edge.html">edge</a></li><li><a href="module-fuse.html">fuse</a><ul class='methods'><li data-type='method'><a href="module-fuse.html#.createIndex">createIndex</a></li><li data-type='method'><a href="module-fuse.html#.search">search</a></li></ul></li><li><a href="module-graph.html">graph</a></li><li><a href="module-lang_language.html">lang/language</a><ul class='methods'><li data-type='method'><a href="module-lang_language.html#.getIdStrings">getIdStrings</a></li><li data-type='method'><a href="module-lang_language.html#.getLanguage">getLanguage</a></li><li data-type='method'><a href="module-lang_language.html#.getString">getString</a></li><li data-type='method'><a href="module-lang_language.html#.setLanguage">setLanguage</a></li><li data-type='method'><a href="module-lang_language.html#.updateHtml">updateHtml</a></li></ul></li><li><a href="module-layout.html">layout</a><ul class='methods'><li data-type='method'><a href="module-layout.html#.positions">positions</a></li><li data-type='method'><a href="module-layout.html#.presetLayout">presetLayout</a></li><li data-type='method'><a href="module-layout.html#.run">run</a></li><li data-type='method'><a href="module-layout.html#.runCached">runCached</a></li><li data-type='method'><a href="module-layout.html#~center">center</a></li><li data-type='method'><a href="module-layout.html#~springLength">springLength</a></li><li data-type='method'><a href="module-layout.html#~storageName">storageName</a></li></ul></li><li><a href="module-loadGraphFromSparql.html">loadGraphFromSparql</a><ul class='methods'><li data-type='method'><a href="module-loadGraphFromSparql.html#~createClassNodes">createClassNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createEdges">createEdges</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createInstanceNodes">createInstanceNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createNodes">createNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~parseLabels">parseLabels</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectClasses">selectClasses</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectInstances">selectInstances</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectTriples">selectTriples</a></li></ul></li><li><a href="module-node.html">node</a></li><li><a href="module-property.html">property</a><ul class='methods'><li data-type='method'><a href="module-property.html#.possible">possible</a></li></ul></li><li><a href="module-rdf.html">rdf</a><ul class='methods'><li data-type='method'><a href="module-rdf.html#.long">long</a></li><li data-type='method'><a href="module-rdf.html#.longPrefix">longPrefix</a></li><li data-type='method'><a href="module-rdf.html#.short">short</a></li><li data-type='method'><a href="module-rdf.html#.sub">sub</a></li></ul></li><li><a href="module-sparql.html">sparql</a><ul class='methods'><li data-type='method'><a href="module-sparql.html#.ask">ask</a></li><li data-type='method'><a href="module-sparql.html#.describe">describe</a></li><li data-type='method'><a href="module-sparql.html#.select">select</a></li></ul></li><li><a href="module-string.html">string</a><ul class='methods'><li data-type='method'><a href="module-string.html#.abbrv">abbrv</a></li></ul></li><li><a href="module-timer.html">timer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#browserCheckNonTranspiled">browserCheckNonTranspiled</a></li><li><a href="global.html#browserCheckTranspiled">browserCheckTranspiled</a></li><li><a href="global.html#flatten">flatten</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#logWrap">logWrap</a></li><li><a href="global.html#menuDefaults">menuDefaults</a></li><li><a href="global.html#sayswho">sayswho</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">browser/filter.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
Filters let the user toggle groups of graph elements, for example all nodes from the meta subontology.
Filters use the Cytoscape.js "display" attribute, while star operations (see graph.js) and reset style use the visibility attribute.
This ensures that filters and star operations interact properly, for example that resetting the style does not show filtered nodes.
See http://js.cytoscape.org/#style/visibility.

@module
*/
import * as NODE from "../node.js";
import {checkboxKeydownListener,checkboxClickableDiv} from "./util.js";
import {views} from "./view.js";

const filterData = [
  [`node[${NODE.SOURCE}='meta']`,`meta`,"meta"],
  [`node[${NODE.SOURCE}='bb']`,`BB`,"bb"],
  [`node[${NODE.SOURCE}='ob']`,`OB`,"ob"],
  [`node[${NODE.SOURCE}='ciox']`,`CioX`,"ciox"],
  [`node[${NODE.SOURCE}='he']`,`HE`,"he"],
  [`node[${NODE.SOURCE}='it']`,`IT`,"it"],
  [`node[${NODE.SOURCE}='it4it']`,`IT4IT`,"it4it"],
  [`node[${NODE.SUBTOP}='${NODE.SUBTOP_ROLE}']`,`Role`,"role"],
  [`node[${NODE.SUBTOP}='${NODE.SUBTOP_FUNCTION}']`,`Function`,"function"],
  [`node[${NODE.SUBTOP}='${NODE.SUBTOP_ENTITY_TYPE}']`,`EntityType`,"entitytype"],
  [`node[?${NODE.INSTANCE}]`,`Show Instances`,"show-instances"],
  [`node[!${NODE.INSTANCE}]`,`Show Non-Instances`],
  [`edge[p='http://www.w3.org/2000/01/rdf-schema#subClassOf']`,`subClassOf`, "subclassof"],
  [`edge[p!='http://www.w3.org/2000/01/rdf-schema#subClassOf']`,`non-subClassOf`, "non-subclassof"],
  [`edge[p^='http://www.w3.org/2004/02/skos/core#']`,`inter-ontology-relations`, "inter-ontology-relations"],
  [`edge[p!^='http://www.w3.org/2004/02/skos/core#']`,`non-inter-ontology-relations`, "non-inter-ontology-relations"],
  //["edge[p='http://www.snik.eu/ontology/meta/subTopClass']","subTopClass"],
  //["node[consolidated&lt;=0]","unverified"]
];

const filters = [];
const GRAPH_GETS_ADDITIONS = true;

// apply a function to all cytoscape cores in all tabs
const multicy = (f) => views().map(v=>v.state.cy).forEach(cy => f(cy));

/**
Toggles the visibility of a set of nodes defined by a selector.
*/
class Filter
{
  /**
  Creates filter with HTML elements, filter functionality and listeners.
  @param {string} selector a Cytoscape.js selector, see {@link http://js.cytoscape.org/#selectors}
  @param {string} label the menu entry label
  @param {string} i18n internationalization key
  */
  constructor(selector,label,i18n)
  {
    this.selector=selector;
    //let input = document.createRange().createContextualFragment('&lt;input type="checkbox" class="filterbox" autocomplete="off" checked="true">'); // can't attach events to fragments
    const input = document.createElement("input");
    input.type="checkbox";
    this.checkbox = input;
    input.classList.add("filterbox");
    input.autocomplete="off";
    input.checked=true;
    this.label=label;
    this.a = document.createElement("a");
    this.a.classList.add("dropdown-entry");
    this.a.appendChild(input);
    this.a.setAttribute("tabindex","-1");
    this.a.addEventListener("keydown",checkboxKeydownListener(input));
    this.a.appendChild(checkboxClickableDiv(input,label,i18n));
    // each filter has its own associated CSS class, such as "filter-BB"
    this.cssClass = `filter-${label}`;
    this.visible = true;
    // Does not apply to elements that get added later, so only use if you don't add elements to the graph. Alternative if you want to use this update this after adding something.
    // Assigns the CSS class of the filter to the nodes that match the filter selector.
    multicy(cy => cy.elements(this.selector).addClass(this.cssClass));
    input.addEventListener("input",()=>this.setVisible(input.checked));
    filters.push(this);
  }

  /** label
   * @return {string} the label*/
  toString() {return this.label;}

  /**
  Set the visibility of the nodes selected by the filter.
  @param {boolean} visible whether the nodes should be visible
  @return {void}
  */
  setVisible(visible)
  {
    if(this.visible===visible) {return;}
    this.visible=visible;

    const hiddenSelectors =
      filters
        .filter(f => !f.visible)
        .map(f => GRAPH_GETS_ADDITIONS? f.selector : ('.'+f.cssClass)); // class selector may be faster

    if(hiddenSelectors.length===0)
    {
      multicy(cy=>cy.elements().removeClass("filtered"));
      // cytoscape.js does not have a class negation selector so we need to add a negation class ourselves
      // see https://stackoverflow.com/questions/54108410/how-to-negate-class-selector-in-cytoscape-js
      multicy(cy=>cy.elements().addClass("unfiltered"));
      log.debug("All filters checked");
    }
    else
    {
      // "or" all selectors together to obtain a combined one
      const hiddenSelector = hiddenSelectors.reduce((a,b)=>a+ ',' +b);
      multicy(cy=>
      {
        const filtered = cy.elements(hiddenSelector);
        filtered.addClass("filtered");
        filtered.removeClass("unfiltered");
        const unfiltered = cy.elements().not(filtered);
        unfiltered.removeClass("filtered");
        unfiltered.addClass("unfiltered");
      });
      log.debug("filter "+hiddenSelector+" triggered");
    }
  }
}

/**
Add filter entries to the filter menu.
@param {HTMLElement} parent the parent element to attach the entries to
@param {array} as an empty array of HTML anchors to be filled
@return {void}
*/
export function addFilterEntries(parent,as)
{
  for(const datum of filterData)
  {
    const filter = new Filter(datum[0],datum[1],datum[2]);
    parent.appendChild(filter.a);
    as.push(filter.a);
  }
}

/** Saves the visibility values of all filters.
@return {object} JSON representation of all filters */
export function toJSON()
{
  const json = {};
  for (const filter of filters)
  {
    json[filter.label]=filter.visible;
  }
  return json;
}

/** Loads the visibility values and applies it to all filters.
@param {object} json JSON representation of all filters
@return {void}
*/
export function fromJSON(json)
{
  for (const filter of filters)
  {
    filter.checkbox.checked = json[filter.label];
    filter.visible = json[filter.label];
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Fri May 07 2021 15:12:37 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
