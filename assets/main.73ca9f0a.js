var et=Object.defineProperty,tt=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var le=(s,e,t)=>e in s?et(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,O=(s,e)=>{for(var t in e||(e={}))st.call(e,t)&&le(s,t,e[t]);if(ke)for(var t of ke(e))ot.call(e,t)&&le(s,t,e[t]);return s},de=(s,e)=>tt(s,nt(e));var b=(s,e,t)=>(le(s,typeof e!="symbol"?e+"":e,t),t);/* empty css              */import{l as c,S as at,c as ce,a as I,t as Ee,b as it,d as rt,G as ct,s as lt,h as dt,F as ut,N as ht,e as ue}from"./vendor.52f4f063.js";const pt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};pt();const m={defaultSubOntologies:["bb","ob","ciox","he","it4it"],allSubOntologies:["meta","bb","ob","ciox","he","he-unconsolidated","it4it"],color:new Map([["ciox","rgb(80,255,250)"],["meta","rgb(255,80,80)"],["ob","rgb(255,173,30)"],["bb","rgb(30,152,255)"],["he","rgb(150,255,120)"],["it","rgb(204, 0, 204)"],["it4it","rgb(255, 255, 0)"]]),nodeSize:39,helperGraphs:["limes-exact","match"],activeOptions:[],searchCloseMatch:!0,logLevelConsole:"debug",logLevelDisplay:"info",logLevelMemory:"debug",layoutCacheMinRecall:.95,layoutCacheMinPrecision:.5,language:"en",download:{image:{max:{width:5e3,height:4e3},standard:{width:1920,height:1920}}},sparql:{endpoint:"https://www.snik.eu/sparql",graph:"http://www.snik.eu/ontology",instances:!1},multiview:{initialTabs:1,warnOnSessionLoad:!0}},ne={GRAPH_BB:"http://www.snik.eu/ontology/bb",PREFIX:"http://www.snik.eu/ontology/",ENDPOINT:"https://www.snik.eu/sparql"};async function x(s,e,t=m.sparql.endpoint){const n=typeof window!="undefined";let o=t+"?query="+encodeURIComponent(s)+"&format=json";e&&(o+="&default-graph-uri="+encodeURIComponent(e));try{const r=(await(await fetch(o)).json()).results.bindings;return n&&console.groupCollapsed("SPARQL "+s.split(`
`,1)[0]+"..."),n&&r.length<100&&console.table(r.map(l=>Object.keys(l).reduce((g,w)=>(g[w]=l[w].value,g),{}))),c.debug(s),c.debug(o),n&&console.groupEnd(),r}catch(i){return c.error(i),c.error(`Error executing SPARQL query:
${s}
URL: ${o}

`),[]}}async function gt(s,e){const t="describe <"+s+">",n=m.sparql.endpoint+"?query="+encodeURIComponent(t)+"&format=text"+(e?"&default-graph-uri="+encodeURIComponent(e):"");try{return await(await fetch(n)).text()}catch(o){throw new Error(`Error executing SPARQL query ${t}: ${o}`)}}function V(s){const e=new Date;return{stop:function(t){const o=new Date().getTime()-e.getTime();c.debug(s+" finished in "+o+" ms"+(t?` (${t})`:""))}}}async function mt(s){const e=V("sparql-classes"),t=`
  PREFIX ov: <http://open.vocab.org/terms/>
  SELECT ?c
  GROUP_CONCAT(distinct(CONCAT(?l,"@",lang(?l)));separator="|") as ?l
  ?src
  ${s}
  {
    ?c a owl:Class.
    OPTIONAL {?c rdfs:label ?l.}
    OPTIONAL {?src ov:defines ?c.}
  }
  `,n=`
  PREFIX ov: <http://open.vocab.org/terms/>
  PREFIX meta: <http://www.snik.eu/ontology/meta/>
  SELECT DISTINCT(?c)
  GROUP_CONCAT(DISTINCT(CONCAT(?l,"@",lang(?l)));separator="|") AS ?l
  SAMPLE(?st) AS ?st
  ?src
  SAMPLE(?inst) AS ?inst
  ${s}
  {
    ?c a owl:Class.
    OPTIONAL {?src ov:defines ?c.}
    OPTIONAL {?c meta:subTopClass ?st.}
    OPTIONAL {?c rdfs:label ?l.}
    OPTIONAL {?inst a ?c.}
  }`,o=m.sparql.endpoint.includes("snik.eu/sparql")?n:t,i=await x(o);return e.stop(i.length+" classes"),i}function $e(s){const e=s.split("|"),t={};for(const n of e){const[o,i]=n.split("@");!o.trim()||(t[i]||(t[i]=[]),t[i].push(o))}return t}async function Le(s){const e=await mt(s),t=[],n=new Set;for(let a=0;a<e.length;a++){let r;e[a].src&&(r=e[a].src.value,r.includes("http://www.snik.eu/ontology/")&&(r=r.replace("http://www.snik.eu/ontology/","")),n.add(r)),t.push({group:"nodes",data:O(O(O({id:e[a].c.value,l:$e(e[a].l.value)},e[a].st&&{st:e[a].st.value.replace("http://www.snik.eu/ontology/meta/","").substring(0,1)}),r&&{source:r}),e[a].inst&&{inst:!0})})}const o=["rgb(30,152,255)","rgb(255,173,30)","rgb(80,255,250)","rgb(150,255,120)","rgb(204, 0, 204)","rgb(255, 255, 0)"];let i=0;for(const a of n)m.color.has(a)||(m.color.set(a,o[i]),i=(i+1)%o.length);return c.debug(e.length+" Nodes loaded from SPARQL"),t}async function ft(s){const e=V("sparql-classes"),t=`SELECT
  DISTINCT(?i)
  GROUP_CONCAT(DISTINCT(CONCAT(?l,"@",lang(?l)));separator="|") AS ?l
  ${s}
  {
    ?i a [a owl:Class].
    OPTIONAL {?i rdfs:label ?l.}
  }
  `,n=await x(t);return e.stop(n.length+" instances"),n}async function wt(s){const e=await ft(s),t=[];for(let n=0;n<e.length;n++)t.push({group:"nodes",data:{id:e[n].i.value,l:$e(e[n].l.value),instance:!0}});return t}async function yt(s,e,t,n){const o=V("sparql-properties"),i=`
    select  ?c ?p ?d
    ${s}
    {
      {?c ?p ?d.} ${n?" UNION {?p rdfs:domain ?c; rdfs:range ?d.}":""}
      {?c a owl:Class.} ${t?" UNION {?c a [a owl:Class]}":""}
      {?d a owl:Class.} ${t?" UNION {?d a [a owl:Class]}":""}
    }`,a=`PREFIX sniko: <http://www.snik.eu/ontology/>
    select  ?c ?p ?d ?g (MIN(?ax) as ?ax)
    ${s}
    ${e}
    {
      graph ?g {?c ?p ?d.}
      filter(?g!=sniko:)
      {?c a owl:Class.} ${t?" UNION {?c a [a owl:Class]}":""}
      {?d a owl:Class.} ${t?" UNION {?d a [a owl:Class]}":""}
      filter(?p!=meta:subTopClass)
      OPTIONAL
      {
        ?ax a owl:Axiom;
        owl:annotatedSource ?c;
        owl:annotatedProperty ?p;
        owl:annotatedTarget ?d.
      }
    }`,r=m.sparql.endpoint.includes("snik.eu/sparql")?a:i,l=await x(r);return o.stop(l.length+" properties"),l}async function bt(s,e,t,n){const o=await yt(s,e,t,n),i=[];for(let a=0;a<o.length;a++)i.push({group:"edges",data:O(O({source:o[a].c.value,target:o[a].d.value,id:String(a),p:o[a].p.value,pl:o[a].p.value.replace(/.*[#/]/,"")},o[a].g&&{g:o[a].g.value}),o[a].ax&&{ax:o[a].ax.value})});return c.debug(o.length+" Edges loaded from SPARQL"),i}async function vt(s,e){if(!e)return Le(s);const[t,n]=await Promise.all([Le(s),wt(s)]);return t.concat(n)}async function Be(s,e,t=!1,n=!1){c.debug(`Loading graph from endpoint ${m.sparql.endpoint} with graphs ${e}.`);const o=e.map(l=>`FROM <${l}>`).reduce((l,g)=>l+`
`+g,""),i=o.replace(/FROM/g,"FROM NAMED"),[a,r]=await Promise.all([vt(o,t),bt(o,i,t,n)]);s.elements().remove(),s.add(a),s.add(r),s.elements().addClass("unfiltered")}const u={ID:"id",LABEL:"l",LABEL_GERMAN:"de",LABEL_ENGLISH:"en",LABEL_PERSIAN:"fa",SUBTOP:"st",SOURCE:"source",INSTANCE:"inst",SUBTOP_ENTITY_TYPE:"E",SUBTOP_ROLE:"R",SUBTOP_FUNCTION:"F"},$="3.0.0",St=500;function L(s){const e=document.getElementById(s);if(!e)throw new Error(`Element with id ${s} does not exist.`);return e}const Ct="https://github.com/snikproject/snik-graph",se="https://github.com/snikproject/ontology";function W(s,e,t,n){let o=encodeURIComponent(t);if(n){const i=n.map(r=>encodeURIComponent(r));let a=i.reduce((r,l)=>r+"%0A"+l);for(;a.length>St;)i.shift(),a=i.reduce((r,l)=>r+"%0A"+l,"");o+="%0A%60%60%60%0A"+a+"%0A%60%60%60"}window.open(`${s}/issues/new?title=${encodeURIComponent(e)}&body=${o}`)}const Ue=s=>e=>{switch(e.key){case" ":case"Enter":s.click()}};function Fe(s,e,t){const n=document.createElement("div");return n.classList.add("dropdown-entry-checkboxtext"),n.innerText=e,t&&n.setAttribute("data-i18n",t),n.addEventListener("click",()=>{s.click()}),n}const f={SOURCE:"source",TARGET:"target",ID:"id",PROPERTY:"p",PROPERTY_LABEL:"pl",GRAPH:"g",AXIOM:"ax"},kt={idStrings:{file:"File","load-sparql":"Load from SPARQL endpoint","load-session":"Load session","load-view":"Load Partial Graph","save-session":"Save Session","save-snik-graph":"Save complete SNIK Graph as Cytoscape File","save-view":"Save current Partial Graph","recalculate-layout-replace":"Recalculate Layout and Replace in Browser Cache","save-image-current-view":"Save Image of Current View","save-image-whole-graph":"Save Image of Whole Graph","save-image-current-view-high-res":"Save Image of Current View (high res)","save-image-whole-graph-high-res":"Save Image of Whole Graph (high res)",filter:"Filter",options:"Options",separateSubs:"separate subontologies",cumulativeSearch:"cumulative search",grid:"show grid",dayMode:"day mode",devMode:"developer mode",extMode:"extended mode",combineMatchMode:"Combine Matches",showInstances:"Show Instances",starNewView:"Star in new View",layout:"Layout","show-close-matches":"show close matches","recalculate-layout":"recalculate layout","tight-layout":"tight layout","compound-layout":"compound layout","bb-chapter-search":"BB chapter search","ob-chapter-search":"OB chapter search","reset-view":"reset main view","move-match-on-top":"move matches on top of each other","move-match-nearby":"move matches nearby","subontology-connectivity":"subontology connectivity","change-title":"change title of active View",services:"Services","sparql-endpoint":"SPARQL Endpoint","rdf-browser":"RDF Browser",language:"Language",english:"english",german:"german",persian:"persian",help:"Help","deselect-all":"deselect all","search-field":"search field","base-mode":"basic menu items","context-menu":"context menu","incoming-star":"incoming star","outgoing-star":"outgoing star","combine-close-matches":"combine close matches","class-use":"class use","show-instances":"show instances"},messageStrings:{"no-search-results-for":"No Search Results for","ontology-issue-warning":"Please note that this is only for feedback about the ontology! Please check if there is already an issue for your problem. If not, we will consider your feedback ASAP."}},Et={idStrings:{file:"Datei","load-sparql":"Lade aus dem SPARQL Endpunkt","load-session":"Lade gespeicherte Sitzung","load-view":"Lade Teilgraph","save-session":"Speichere aktuelle Sitzung","save-snik-graph":"Speichere kompletten SNIK Graph als Cytoscape Datei","save-view":"Speichere aktuellen Teilgraphen","recalculate-layout-replace":"Layout neu berechnen und im Browser Cache platzieren","save-image-current-view":"Speichere Bilddatei der aktuellen Ansicht","save-image-whole-graph":"Speichere Bilddatei des kompletten Graphen","save-image-current-view-high-res":"Speichere Bilddatei der aktuellen Ansicht (hohe Aufl\xF6sung)","save-image-whole-graph-high-res":"Speichere Bilddatei des kompletten Graphen (hohe Aufl\xF6sung)",filter:"Filter",options:"Optionen",separateSubs:"nach Subontologien aufspalten",cumulativeSearch:"Kumulative Suche",grid:"Raster anzeigen",dayMode:"Tag-Modus",devMode:"Entwickler-Modus",extMode:"Erweiterter Modus",combineMatchMode:"\xDCbereinstimmungen zusammenfassen",showInstances:"Instanzen zeigen",layout:"Layout","show-close-matches":"Zeige close matches","recalculate-layout":"Layout neu berechnen","tight-layout":"Dichtes Layout","compound-layout":"verbundenes Layout","bb-chapter-search":"BB Kapitelsuche","ob-chapter-search":"OB Kapitelsuche","reset-view":"Ansicht des Gesamtmodells zur\xFCcksetzen","move-match-on-top":"Zeige close matches \xFCbereinander","move-match-nearby":"Zeige close matches verbunden","subontology-connectivity":"Konnektivit\xE4t zwischen Subontologien","change-title":"Titel des aktuellen View \xE4ndern",services:"Services","sparql-endpoint":"SPARQL Endpunkt","rdf-browser":"RDF Browser",language:"Sprache",english:"Englisch",german:"Deutsch",persian:"Persisch",help:"Hilfe","deselect-all":"alle abw\xE4hlen","search-field":"Suchfeld","base-mode":"Basismodus","context-menu":"Kontextmen\xFC","incoming-star":"eingehener Stern","outgoing-star":"ausgehender Stern","combine-close-matches":"kombiniere close matches","class-use":"Klassenbenutzung","show-instances":"zeige Instanzen"},messageStrings:{"no-search-results-for":"Keine Suchresultate f\xFCr","ontology-issue-warning":"Bitte hier nur Feedback zur Ontologie hinterlassen! Bitte pr\xFCfen Sie vorher, ob es schon eine Issue mit diesem Thema gibt. Wenn nicht, bearbeiten wir Ihr Feedback so schnell wie m\xF6glich."}},ve={en:kt,de:Et,fa:{idStrings:{},messageStrings:{}}};let D="en";function Lt(s){return c.debug(`Set language from ${D} to ${s}.`),ve[s]?(D=s,!0):(c.warn(`Language ${s} not found. Keeping language ${D}.`),!1)}function De(){return D}function ze(s){const e=ve[D];return e.all||(e.all=O(O({},e.idStrings),e.messageStrings)),e.all[s]}function Tt(){return ve[D].idStrings}const we={SPARUL_WARNING:'Please be careful with all SPARUL operations and always create a <a href="https://wiki.imise.uni-leipzig.de/Projekte/SNIK/ontologie/sparql">SPARQL dump</a> as a backup beforehand.'};function Ot(){const s=Tt(),e=[];for(const t of Object.keys(s)){const n=document.querySelectorAll(`[data-i18n="${t}"]`);if(n.length===0){e.push(t);continue}for(const o of n){const i=s[t];switch(o.tagName){case"A":case"BUTTON":case"DIV":case"SPAN":o.textContent=i;break;default:c.warn(`Cannot assign text "${i}" to element with i18n key ${t} because its tag type ${o.tagName} is unsupported.`)}}}e.length>0&&c.debug(`UpdateHtml: i18n keys ${e.toString()} not used`)}const he={format_version:"1.0",generated_by:"cytoscape-3.4.0",target_cytoscapejs_version:"~2.1",title:"MyStyle1",style:[{selector:"node",css:{"min-zoomed-font-size":5,width:m.nodeSize,height:m.nodeSize,"font-size":11,"text-valign":"center","text-halign":"center","border-opacity":1,"border-width":function(s){return s.data(u.INSTANCE)?1:0},"font-family":"sans-serif","font-weight":"normal","background-opacity":.5882352941176471,"text-opacity":1,shape:function(s){switch(s.data(u.SUBTOP)){case u.SUBTOP_ENTITY_TYPE:return"rectangle";case u.SUBTOP_ROLE:return"ellipse";case u.SUBTOP_FUNCTION:return"triangle"}switch(s.data(u.ID)){case"http://www.snik.eu/ontology/meta/EntityType":return"rectangle";case"http://www.snik.eu/ontology/meta/Role":return"ellipse";case"http://www.snik.eu/ontology/meta/Function":return"triangle";default:return"hexagon"}},label:function(s){let e=s.data(u.LABEL);if(!e)return s.data(u.ID);let t;if((t=e[De()])&&(t=t[0]))e=t;else{let n=!1;for(const o of[u.LABEL_ENGLISH,u.LABEL_GERMAN,u.LABEL_PERSIAN])if((t=e[o])&&t[0]){e=t[0],n=!0;break}if(!n){const o=Object.keys(e);o.length>0?e=e[o[0]]:e=s.data(u.ID)}}return s.data(u.INSTANCE)&&(e+="*"),e}}},{selector:"node.source",css:{"border-width":5}},{selector:"node.target",css:{"border-width":5}},{selector:"node.highlighted",css:{"border-width":5}},{selector:"node:selected",css:{"border-width":8}},{selector:"edge",css:{"z-compound-depth":"bottom",width:2,opacity:.2}},{selector:"edge.highlighted,edge:selected,edge.starmode",css:{"text-opacity":1,"mid-target-arrow-shape":function(s){switch(s.data(f.PROPERTY)){case"http://www.snik.eu/ontology/meta/isAssociatedWith":case"http://www.w3.org/2004/02/skos/core#closeMatch":case"http://www.w3.org/2004/02/skos/core#relatedMatch":case"http://www.w3.org/2004/02/skos/core#related":case"http://www.w3.org/2004/02/skos/core#exactMatch":return"none"}return"triangle"},"text-margin-y":"-1em","min-zoomed-font-size":5,"font-size":11,label:function(s){let e=s.data(f.PROPERTY_LABEL);return s.data(f.GRAPH)==="http://www.snik.eu/ontology/limes-exact"&&(e+=" \u26A0"),e}}},{selector:"edge.highlighted,edge:selected",css:{width:4,opacity:1}},{selector:".filtered",css:{display:"none"}},{selector:".hidden",css:{visibility:"hidden"}},{selector:"$node > node",css:{shape:"rectangle","border-width":10,"text-valign":"top","text-margin-y":"-0.7em","min-zoomed-font-size":7.5,"font-size":16,"background-opacity":"0"}},{selector:"node[i]",css:{shape:"star"}},{selector:"node",css:{"background-color":s=>{let e=m.color.get(s.data(u.SOURCE));return e||(e="rgb(254,196,79)"),e},color:"white"}}]},Te=[{selector:"node",css:{color:"white","border-color":"white"}},{selector:"node:selected",css:{"background-color":"rgb(255,255,0)"}},{selector:"node.source",css:{"border-color":"rgb(128,255,128)"}},{selector:"node.target",css:{"border-color":"rgb(255,90,90)"}},{selector:"edge:unselected",css:{"line-color":function(s){return String(s.data(f.PROPERTY)).substring(0,36)==="http://www.w3.org/2004/02/skos/core#"?"rgb(255,255,190)":"rgb(252,252,252)"}}},{selector:"edge.starmode",css:{color:"rgb(128,128,128)","mid-target-arrow-color":"rgb(128,128,128)"}},{selector:"edge:selected,edge.highlighted",css:{color:"rgb(255,255,128)","line-color":"rgb(255,255,128)","mid-target-arrow-color":"rgb(255,255,128)"}}],Nt=[{selector:"node",css:{color:"black","border-color":"black"}},{selector:"node:selected",css:{"background-color":"rgb(0,0,255)"}},{selector:"node.source",css:{"border-color":"rgb(128,0,128)"}},{selector:"node.target",css:{"border-color":"rgb(0,165,165)"}},{selector:"edge[!selected]",css:{"line-color":function(s){return String(s.data(f.PROPERTY)).substring(0,36)==="http://www.w3.org/2004/02/skos/core#"?"rgb(140,130,10)":"rgb(110,110,110)"}}},{selector:"edge.starmode",css:{opacity:1,"mid-target-arrow-color":"rgb(128,128,128)",color:"rgb(20,20,20)"}},{selector:"edge:selected,edge.highlighted",css:{color:"rgb(0,0,128)","line-color":"rgb(0,0,128)","mid-target-arrow-color":"rgb(0,0,128)"}}],Ge=[["meta","http://www.snik.eu/ontology/meta/"],["bb","http://www.snik.eu/ontology/bb/"],["ob","http://www.snik.eu/ontology/ob/"],["he","http://www.snik.eu/ontology/he/"],["ciox","http://www.snik.eu/ontology/ciox/"],["it4it","http://www.snik.eu/ontology/it4it/"],["it","http://www.snik.eu/ontology/it/"],["skos","http://www.w3.org/2004/02/skos/core#"],["rdfs","http://www.w3.org/2000/01/rdf-schema#"],["rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"]];function oe(s){for(const e of Ge)if(s.startsWith(e[1]))return e[1].replace(/\/$/,"");return s}function z(s){for(const e of Ge)s=s.replace(e[1],e[0]+":");return s}function It(s){return s.startsWith("http://www.snik.eu/ontology/")?s.replace(/\/[^/]*$/,""):null}const xt={lines:13,length:28,width:35,radius:84,scale:3,corners:1,color:"#ffffff",opacity:.6,rotate:35,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"absolute"};let Q=null,_=0;async function K(s){!window||(Q||(Q=new at(xt)),_||(document.body.classList.add("waiting"),Q.spin(document.body)),_++,await s(),_--,_<=0&&(document.body.classList.remove("waiting"),Q.stop()))}var F=(s=>(s[s.IN=0]="IN",s[s.OUT=1]="OUT",s[s.BOTH=2]="BOTH",s))(F||{});class y{constructor(e){b(this,"cy");b(this,"selectedNode",null);b(this,"starMode",!1);b(this,"matchComponents",[]);b(this,"pathSource",null);b(this,"container");b(this,"instancesLoaded",!1);b(this,"menu",null);const t=V("graph-init");this.container=e,this.container.style.backgroundColor="black",this.cy=ce({container:e,style:he.style.concat(Te),wheelSensitivity:.3,minZoom:.02,maxZoom:7}),this.cy.on("select","node",o=>{this.selectedNode=o.target});const n=["resetStyle","presentUri","showPath","showStar","showWorm","showDoubleStar","combineMatch","showCloseMatch","subOntologyConnectivity","newGraph"];for(const o of n)this[o]=this[o].bind(this);t.stop()}cumulativeSearch(){return(document.getElementById("cumulativeSearchBox")||{}).checked}static setVisible(e,t=!0){if(t)e.removeClass("hidden");else{e.addClass("hidden"),e.removeClass("highlighted");const n=e.nodes().connectedEdges();n.addClass("hidden"),n.removeClass("highlighted")}}static starStyle(e){e.removeClass("hidden"),e.select()}resetStyle(){this.starMode=!1,this.cy.startBatch(),this.cy.elements().removeClass("highlighted"),this.cy.elements().removeClass("starmode"),this.cy.elements().removeClass("hidden"),this.cy.endBatch()}showPath(e,t){return n=>{if(!n)return c.error("No path source."),!1;if(n===e)return c.warn(`Path source ${n.data(u.ID)} equals target.`),!1;const o=this.cy.elements(".unfiltered"),a=o.aStar({root:n,goal:e}).path;if(a){if(this.cy.startBatch(),this.cy.add(a),t){const r=a.connectedEdges(".unfiltered");a.merge(r),a.merge(r.connectedNodes(".unfiltered"))}y.starStyle(a),this.starMode?a.select():(this.starMode=!0,y.setVisible(o.not(a),!1)),this.cy.endBatch()}else return this.starMode||this.resetStyle(),c.warn("No path found!"),!1;return!0}}showStarMultiplexed(e=!1,t){return this.multiplex(n=>this.showStar(n,e,t),void 0,!0)}async showStarMultiplexedNew(e=!1,t){const n=await this.newGraph();return i=>(n.multiplex(a=>n.showStar(n.assimilateNodes(a),e,t),n.assimilateNodes(this.cy.nodes(":selected")),!0)(i),n)}showStar(e,t=!1,n){console.log("center",e),this.cy.startBatch();let o=e,i;for(let h=0;h<o.size();)h=o.size(),i=o.connectedEdges(".unfiltered").filter('[pl="closeMatch"]'),o=o.union(i.connectedNodes(".unfiltered"));let a;switch(n){case 0:a=this.cy.elements(".unfiltered").edgesTo(o);break;case 1:a=o.edgesTo(".unfiltered");break;default:a=o.connectedEdges(".unfiltered")}const r=a.connectedNodes(".unfiltered"),l=o.union(r).union(a);l.merge(l.parent()),l.merge(l.children());const g=r.difference(o);(t||!this.starMode)&&(this.starMode=!0,y.setVisible(this.cy.elements().not(l),!1)),console.log("star",l),y.starStyle(l),t&&r.sort((p,v)=>{const C=Math.min(p.edgesTo(o).map(R=>R.data("pl").split("").reduce((k,H)=>k+H.charCodeAt(0),0))),S=Math.min(v.edgesTo(o).map(R=>R.data("pl").split("").reduce((k,H)=>k+H.charCodeAt(0),0)));return C-S}).layout({name:"concentric",fit:!0,levelWidth:function(){return 1},minNodeSpacing:175,concentric:function(p){if(o.contains(p))return 2;if(g.contains(p))return 1;throw new Error("unexpected node in star")}}).run(),this.cy.endBatch(),y.setVisible(g.edgesWith(this.cy.nodes(".unfiltered").not(".hidden")));const w=this.cy.nodes(":visible");w.size()<100&&this.cy.fit(w,100)}showWorm(e){return this.showPath(e)?(this.showStar(e),!0):!1}showDoubleStar(e){const t=this.getSource();return this.showPath(e)?(this.showStar(e),this.showStar(t),!0):!1}assimilate(e){return this.getElementsByIds(e.map(t=>t.id()))}assimilateNodes(e){return this.getElementsByIds(e.map(t=>t.id()))}getElementsByIds(e){const t=this.cy.collection();for(const n of e){const o=this.cy.getElementById(n);t.merge(o)}return t}getSource(){return this.pathSource?this.pathSource:this.selectedNode?(c.debug("Path source not set, using selected node"),this.selectedNode):null}setSource(e){return c.debug("Setting path source to "+e.data(u.ID)),e?e.length!==1?(c.error("Invalid source. Length != 1"),!1):(this.pathTarget&&this.cy.resize(),this.pathSource&&this.pathSource.removeClass("source"),this.pathSource===e?(c.info("Toggling path source off."),this.pathSource=null,!0):(this.pathSource=e,this.pathSource.addClass("source"),!0)):!1}invert(e){e?(this.container.style.backgroundColor="white",this.cy.style().fromJson(he.style.concat(Nt)).update()):(this.container.style.backgroundColor="black",this.cy.style().fromJson(he.style.concat(Te)).update())}presentUri(e){this.cy.zoom(.6);const t=this.cy.elements().nodes().filter(`node[id= "${e}"]`);if(t.length<1)return c.warn(`Node not in graph. ${e} may be available on the SPARQL endpoint but not in the graph.`),!1;const n=t[0];return n.hasClass("filtered")?(c.warn(`Node is filtered out. ${e} is not visible. Please adjust filters.`),!1):(n.hasClass("hidden")&&(c.debug(`Node is hidden. Unhiding ${e}.`),y.setVisible(n,!0),y.setVisible(n.edgesWith(this.cy.nodes(":visible")),!0)),this.starMode||this.cumulativeSearch()||this.resetStyle(),this.cy.elements().unselect(),n.select(),this.cy.center(n),!0)}presentUris(e,t=!1){if(e.length<1)return c.warn("All search results are only available on the SPARQL endpoint but not in the graph."),!1;this.cumulativeSearch()||this.resetStyle();const n=this.cy.elements().nodes().filter(o=>e.includes(o.data(u.ID)));return t&&(y.setVisible(this.cy.elements(),!1),y.setVisible(n.edgesTo(n),!0),this.starMode=!0),this.cy.elements().unselect(),n.select(),n.edgesTo(n).select(),this.cy.fit(this.cy.elements(":selected")),!0}multiplex(e,t,n){return o=>{const i=this.cy.nodes(":selected");let a=t;if(!t&&i.size()>1&&(a=i),a)if(o&&(a=a.union(o)),c.debug("multiplexing of "+a.size()+" elements (direct="+n+")"),n)e(a);else for(let r=0;r<a.length;r++)e(a[r]);else e(o)}}createRemoveIssue(e){this.cy.remove(e);const t=z(e.data(u.ID));gt(e.data(u.ID)).then(n=>{const o=`Please permanently delete the class ${t}:
            \`\`\`

            sparql
            # WARNING: THIS WILL DELETE ALL TRIPLES THAT CONTAIN THE CLASS ${t} FROM THE GRAPH AS EITHER SUBJECT OR OBJECT
            # ALWAYS CREATE A BACKUP BEFORE THIS OPERATION AS A MISTAKE MAY DELETE THE WHOLE GRAPH.
            # THERE MAY BE DATA LEFT OVER IN OTHER GRAPHS, SUCH AS <http://www.snik.eu/ontology/limes-exact> or <http://www.snik.eu/ontology/match>.
            # THERE MAY BE LEFTOVER DATA IN AXIOMS OR ANNOTATIONS, CHECK THE UNDO DATA FOR SUCH THINGS.

            DELETE DATA FROM <${oe(e.data(u.ID))}>
            {
              {<${e.data(u.ID)}> ?p ?y.} UNION {?x ?p <${e.data(u.ID)}>.}
            }
            
\`\`\`
            **Warning: Restoring a class with the following triples is not guaranteed to work and may have unintended consequences if other edits occur between the deletion and restoration.
            This only contains the triples from graph ${oe(e.data(u.ID))}.**

            Undo based on these triples:
            \`\`\`

            ${n}
            
\`\`\`
            ${we.SPARUL_WARNING}`;window.open("https://github.com/IMISE/snik-ontology/issues/new?title="+encodeURIComponent("Remove class "+t)+"&body="+encodeURIComponent(o))})}moveAllMatches(e){for(let t=0;t<this.matchComponents.length;t++){const n=this.matchComponents[t];n.length!==1&&this.moveNodes(n.nodes(),e)}}moveNodes(e,t){e.positions(e[0].position());for(let n=1;n<e.length;n++)e[n].shift({x:t*Math.cos(2*Math.PI*n/(e.length-1)),y:t*Math.sin(2*Math.PI*n/(e.length-1))})}async combineMatch(e){await K(()=>{if(!e){this.cy.startBatch(),this.cy.nodes(":child").move({parent:null}),this.cy.nodes("[id ^= 'parent']").remove(),this.matchComponents.length=0,this.cy.endBatch();return}this.cy.startBatch();const t=this.cy.edges('[pl="closeMatch"]').filter(".unfiltered").not(".hidden"),n=this.cy.nodes(".unfiltered").not(".hidden").union(t);!this.moveMatchNotified&&this.cy.nodes(":visible").size()>1e3&&(c.info("Combining Matches. Consider using Move Matches Nearby or Move Matches on top of each other."),this.moveMatchNotified=!0),this.matchComponents.length=0,this.matchComponents.push(...n.components());for(let o=0;o<this.matchComponents.length;o++){const i=this.matchComponents[o];if(i.length===1)continue;const a="parent"+o,r={};let l=i.nodes();for(let h=0;h<l.length;h++){const p=l[h].data("l");for(const v in p)r[v]||(r[v]=new Set),p[v].forEach(C=>r[v].add(C))}for(const h in r)r[h]=[[...r[h]].reduce((p,v)=>p+", "+v)];const g=["bb","ob","he","it4it","ciox"],w=h=>{let p=g.indexOf(h);return p===-1&&(p=99),p};l=l.sort((h,p)=>w(h.data(u.SOURCE))-w(p.data(u.SOURCE))),this.cy.add({group:"nodes",data:{id:a,l:r}});for(let h=0;h<l.length;h++)l[h].move({parent:a})}this.cy.endBatch()})}showCloseMatch(e){const t=e.connectedEdges(".unfiltered").filter('[pl="closeMatch"]'),n=t.connectedNodes(".unfiltered");c.debug(`Showing close matches of ${e.length} nodes ${JSON.stringify(e.map(i=>i.id()))}.
Results: ${JSON.stringify(n.map(i=>i.id()))}`);const o=n.union(t);y.setVisible(o,!0),y.starStyle(o)}subOntologyConnectivity(){I.show("subontology-connectivity");const e=document.getElementById("subontology-connectivity-form");e.listener||(e.listener=async t=>{t.preventDefault(),I.close("subontology-connectivity");const n=new d;await n.initialized;const o=[e[0].value,e[1].value];c.debug(`Showing connectivity between the subontologies ${o[0]} and ${o[1]}.`);const i=o.map(l=>n.state.cy.nodes(`[source="${l}"]`)),r=i[0].edgesWith(i[1]).connectedNodes();y.setVisible(n.state.cy.elements(),!1),y.setVisible(r,!0),y.setVisible(r.edgesWith(r),!0),r.layout({name:"concentric",fit:!0,levelWidth:function(){return 1},minNodeSpacing:60,concentric:function(l){return i[0].contains(l)?2:1}}).run()},e.addEventListener("submit",e.listener))}async newGraph(e){if(this!==d.mainView.state.graph)return this;const t=new d(!0,e);return await t.initialized,t.state.graph}}let Rt=0;async function At(s,e){const t={R:["meta:Role","meta:Function","meta:EntityType"],F:["meta:Function","meta:Role","meta:EntityType"],E:["meta:EntityType","meta:Function","meta:Role"]};if(!(e in t)){c.error("Unknown subtop '"+e+"'. Cannot display class use.");return}const[n,o,i]=t[e],a=`select distinct ?inner ?middle ?outer ?outerx
    {
      <${s}> (rdfs:subClassOf|skos:closeMatch|^skos:closeMatch)* ?inner.
      ?inner meta:subTopClass ${n}.
      OPTIONAL
      {
        ?inner ?p ?middle.
        ?middle meta:subTopClass ${o}.
        OPTIONAL
        {
          ?middle ?q ?outer.
          ?outer meta:subTopClass ${i}.
          OPTIONAL {?outer (skos:closeMatch|^skos:closeMatch|^rdfs:subClassOf)+ ?outerx.}
        }
      }
    }`,r=await x(a),[l,g,w,h]=[...new Array(4)].map(()=>new Set);for(let E=0;E<r.length;E++)l.add(r[E].inner.value),r[E].middle&&g.add(r[E].middle.value),r[E].outer&&w.add(r[E].outer.value),r[E].outerx&&h.add(r[E].outerx.value);if(g.size===0){c.warn("Class "+s+" is not used.");return}const v=document.getElementById("combineMatchModeBox").checked;v&&d.mainView.state.graph.combineMatch(!1);const C=new d(!0,"Class Use "+ ++Rt+" "+z(s));await C.initialized;const S=C.state.graph;S.cy.startBatch(),S.resetStyle(),y.setVisible(S.cy.elements(),!1),S.starMode=!0;const R=new Set([...l,...g,...w,...h]),k=S.cy.collection(`node[id='${s}']`);for(const E of R){const M=S.cy.nodes(`node[id='${E}']`);k.merge(M)}const H=k.merge(k.edgesWith(k));k.layout({name:"concentric",fit:!0,levelWidth:function(){return 1},minNodeSpacing:20,concentric:function(E){const M=E.data(u.ID);return M===s?10:l.has(M)?9:g.has(M)?8:w.has(M)?7:h.has(M)?6:10}}).run(),y.setVisible(H,!0),v&&[d.mainView,C].forEach(E=>E.state.graph.combineMatch(!0));const Ze=S.cy.nodes(`node[id='${s}']`);S.cy.center(Ze),S.cy.fit(k),S.cy.endBatch()}const pe=s=>e=>s(e.target);function Mt(s){return[{content:"compound",id:"compound",selector:"node:compound",submenu:[{content:"open",id:"open",onClickFunction:e=>{e.target.children().move({event:null}),s.cy.remove(e.target)}},{content:"move matches on top of each other",id:"move-match-on-top",onClickFunction:e=>s.moveNodes(e.target.children(),0)},{content:"move matches nearby",id:"move-match-nearby",onClickFunction:e=>s.moveNodes(e.target.children(),100)},{content:"star",id:"compound-star",onClickFunction:e=>s.multiplex(s.showStar,e.target.children(),!0)()},{content:"incoming star",id:"compound-incoming-star",onClickFunction:e=>s.multiplex(t=>s.showStar(t,!1,F.IN),e.target.children(),!0)()},{content:"outgoing star",id:"compound-outgoing-star",onClickFunction:e=>s.multiplex(t=>s.showStar(t,!1,F.OUT),e.target.children(),!0)()},{content:"set as path source",id:"compound-path-source",onClickFunction:e=>{s.setSource(e.target.children()[0])}}]},{content:"edit/report",id:"edit",selector:"node",onClickFunction:e=>{const t=e.target,n=`Problem with the class [${z(t.data(u.ID))}](${t.data(u.ID)}) ([OntoWiki URL](${J.ontoWikiUrl(t.data(u.ID))})):

`;W(se,t.data(u.ID),n)}},{content:"class use",id:"class-use",selector:"node",onClickFunction:e=>{const t=e.target;At(t.data(u.ID),t.data(u.SUBTOP))}},{content:"hide",id:"hide",selector:"node",onClickFunction:pe(s.multiplex(e=>y.setVisible(e,!1)))},{content:"set as path source",id:"set-path-source",selector:"node",onClickFunction:e=>{s.setSource(e.target)}},{content:"description",id:"description",selector:"node",onClickFunction:e=>{window.open(e.target.data(u.ID))}},{content:"star",id:"star",selector:"node",onClickFunction:async e=>{(await s.showStarMultiplexedNew(!1,F.BOTH))(e.target)}},{content:"incoming star",id:"incoming-star",selector:"node",onClickFunction:async e=>{(await s.showStarMultiplexedNew(!1,F.IN))(e.target)}},{content:"outgoing star",id:"outgoing-star",selector:"node",onClickFunction:async e=>{(await s.showStarMultiplexedNew(!1,F.OUT))(e.target)}},{content:"path",id:"path",selector:"node",onClickFunction:e=>s.multiplex(s.showPath(e.target))(s.getSource())},{content:"spiderworm",id:"spiderworm",selector:"node",onClickFunction:pe(s.multiplex(s.showWorm))},{content:"developer",id:"dev",selector:"node",submenu:[{content:"remove permanently",id:"remove-permanently",selector:"node",onClickFunction:e=>s.createRemoveIssue(e.target)},{content:"OntoWiki",id:"ontowiki",selector:"node",onClickFunction:e=>window.open(J.ontoWikiUrl(e.target.data(u.ID)))},{content:"debug",id:"debug",selector:"node",onClickFunction:e=>alert(JSON.stringify(e.target.data(),null,2))}]},{content:"extended",id:"ext",selector:"node",submenu:[{content:"doublestar",id:"doublestar",selector:"node",onClickFunction:e=>s.multiplex(s.showDoubleStar)(e.target)},{content:"starpath",id:"starpath",selector:"node",onClickFunction:e=>s.multiplex(s.showPath(e.target,!0))(s.getSource())},{content:"circle star",id:"circlestar",selector:"node",onClickFunction:e=>{s.showStar(e.target,!0)}},{content:"LodLive",id:"lodlive",selector:"node",onClickFunction:e=>{window.open("http://en.lodlive.it/?"+e.target.data(u.ID))}},{content:"move all selected here",id:"move-selected",selector:"node",onClickFunction:e=>{s.cy.nodes(":selected").positions(()=>e.target.position())}},{content:"close matches",id:"close-match",selector:"node",onClickFunction:pe(s.multiplex(s.showCloseMatch,void 0,!0))},{content:"show instances",id:"show-instances",onClickFunction:async e=>{const n=e.target.data(u.ID),o=`SELECT ?i STR(SAMPLE(?label)) AS ?l {
        ?i a <${n}>
        OPTIONAL {?i rdfs:label ?label. FILTER(LANGMATCHES(LANG(?label),"${De()}"))}
        }`;let a=(await x(o)).map(r=>r.i.value+" "+(r.l?r.l.value:"")).reduce((r,l)=>r+`
`+l,"");a===""&&(a=`Class ${n} does not have any instances.`),alert(a)}}]}]}function B(s){return z(s.data(f.SOURCE))+" "+z(s.data(f.PROPERTY))+" "+z(s.data(f.TARGET))}function Pt(s){return[{content:"edit / report",id:"edge-edit",selector:"edge",onClickFunction:t=>{const n=t.target,o=`Problem with the edge [${B(n)}](${n.data(f.SOURCE)}) ([OntoWiki URL](${J.ontoWikiUrl(n.data(f.SOURCE))})):

`;W(se,B(n),o)}},{content:"hide",id:"edge-hide",selector:"edge",onClickFunction:t=>y.setVisible(t.target,!1)},{content:"description (if it exists)",id:"edge-description",selector:"edge",onClickFunction:t=>{const n=t.target;n.data(f.AXIOM)?window.open(n.data(f.AXIOM)):c.warn("There is no description for this edge.")}},{content:"confirm link",id:"edge-confirm-link",selector:"edge",onClickFunction:t=>{const n=t.target;n.data(f.GRAPH,"http://www.snik.eu/ontology/match");const o=`Please confirm the automatic interlink ${B(n)}:
					\`\`\`

					sparql
					DELETE DATA FROM <http://www.snik.eu/ontology/limes-exact>
					{<${n.data(f.SOURCE)}> <${n.data(f.PROPERTY)}> <${n.data(f.TARGET)}>.}
					INSERT DATA INTO <http://www.snik.eu/ontology/match>
					{<${n.data(f.SOURCE)}> <${n.data(f.PROPERTY)}> <${n.data(f.TARGET)}>.}
					
\`\`\`
					Undo with
					\`\`\`

					sparql
					DELETE DATA FROM <http://www.snik.eu/ontology/match>
					{<${n.data(f.SOURCE)}> <${n.data(f.PROPERTY)}> <${n.data(f.TARGET)}>.}
					INSERT DATA INTO <http://www.snik.eu/ontology/limes-exact>
					{<${n.data(f.SOURCE)}> <${n.data(f.PROPERTY)}> <${n.data(f.TARGET)}>.}
					
\`\`\`
					${we.SPARUL_WARNING}`;W(se,B(n),o)}},{content:"developer",id:"edge-dev",selector:"edge",submenu:[{content:"remove permanently",id:"remove-permanently",onClickFunction:t=>{const n=t.target;s.cy.remove(n);const o=`Please permanently delete the edge ${B(n)}:
					\`\`\`

					sparql
					DELETE DATA FROM <${oe(n.data(f.SOURCE))}>
					{<${n.data(f.SOURCE)}> <${n.data(f.PROPERTY)}> <${n.data(f.TARGET)}>.}
					
\`\`\`
					Undo with
					\`\`\`

					sparql
					INSERT DATA INTO <${oe(n.data(f.SOURCE))}>
					{<${n.data(f.SOURCE)}> <${n.data(f.PROPERTY)}> <${n.data(f.TARGET)}>.}
					
\`\`\`
					${we.SPARUL_WARNING}`;W(se,B(n),o)}},{content:"OntoWiki",id:"edge-ontowiki",onClickFunction:t=>{window.open(J.ontoWikiUrl(t.target.data(f.SOURCE)))}},{content:"debug",id:"edge-debug",onClickFunction:t=>{alert(JSON.stringify(t.target.data(),null,2))}}]}]}const $t={"SNIK Graph Manual":{img:"graph.png"},"Multiview-Functionality":{"":"SNIK Graph supports the organization and management of different partial models in separate views.To copy a part of the whole graph, press 'C' or 'S' and to insert it into a new model press 'V' or 'P'.","search-field":"Search the currently active view for resources by entering a full or partial name.","View-specific menu":{"":"The view-specific menu can be found in the upper right position of each view, described from left to right.",img:"viewmenu.png",recalculatesign:"Recalculate Layout",tightlayoutsign:"Tight layout",compoundlayoutsign:"Compound layout",addsign:"Open new Tab",plussign:"Zoom in",minussign:"Zoom out"}},menu:{file:{"":"Holds different file options like loading and saving the graph in different ways.","load-sparql":"Discard the currently loaded graph and load all ontologies of SNIK.","load-session":"Load a complete session from a Cytoscape JSON File. Caution: Discards all changes!","load-view":"Load a saved view (partial graph) and include it in the current session.","save-session":"Save the complete Session (all views).","save-snik-graph":"Save the complete SNIK graph to a Cytoscape file.","save-view":"Save only the currently active view (partial graph).","recalculate-layout-replace":"Recalculate the position of all visible nodes. May take a while when a large number of nodes are visible.","save-image-current-view":"Save a screenshot of the currently active view.","save-image-whole-graph":"Save an image of the whole graph with the same pixel density as the current view.","save-image-current-view-high-res":"Save an image of the current view with a high resolution, for example for printing.","save-image-whole-graph-high-res":"Save an image of the whole graph with a high resolution, for example for printing."},filter:{"":"A collection of filters to display relevant subgraphs. Filters are applied to all open views.",meta:"The Meta Ontology provides common superclasses and properties for the subontologies of SNIK.",bb:'Based on the book "Health Information Systems Ontology\u2013Architectures and Strategies".',ob:'Based on the book"IT-Projektmanagement im Gesundheitswesen - Lehrbuch und Projektleitfaden.',he:'Based on the book "Informationsmanagement: Grundlagen, Aufgaben, Methoden".',ciox:"Based on interviews about the Health Information System with Department B1, the Department for Information Management, of the Uniklinikum Leipzig.",role:"Who...",function:"...does what...",entitytype:"...and which information is therefore needed."},options:{"":"Here you can find different checkboxes that toggle the behaviour of SNIK Graph. These are applied to all open views.","separate-subs":"Spread the SNIK Graph into subgraphs of the subontologies.","cumulative-search":"Keep previous search results visible when searching again.",grid:"shows a grid that supports better organizing of nodes.","combine-match":'Highlights groups of classes representing the same concept from different subontologies (matches) by placing them in boxes. Use "move matches on top of each other" or "move matches nearby" to shrink those boxes.',showInstances:"Display instances of SNIK Classes, if loaded via parameter.","day-mode":"White background. Saves ink when printing.","dev-mode":"Additional context menu entries for developers.","ext-mode":"Additional context menu entries for power users."},layout:{"":"This part of the menu holds the layout features.","show-close-matches":"Shows (unhides) all nodes that are connected via close matches to visible nodes.","recalculate-layout":"Hotkey: Ctrl+Alt+L. Recalculates the position of all selected nodes, or all visible nodes if there are not at least two selected nodes. Can take a while if there are many visible nodes.","tight-layout":"Hotkey: Ctrl+Alt+T. You can use this for a more narrow view.","compound-layout":"Hotkey: Ctrl+Alt+C. Layout that tries to places combined matches next to each other.","move-match-on-top":'Requires enabled "Combine Matching" option. Places all matching nodes in the center of their group.',"move-match-nearby":'Requires enabled "Combine Matching" option. Places all matching nodes in a small circle in their group.',"bb-chapter-search":'Presents you all chapters of the "blue book" and lets you build a subgraph out of selected chapters .',"ob-chapter-search":'Presents you all chapters of the "orange book" and lets you build a subgraph out of selected chapters .',"subontology-connectivity":"Shows the connectivity between chosen Subontologies, i.e. between BB and OB, in a new tab.",img:"subontologyConnectivity.png","reset-view":"Resets all the layout operations to get you back to the starting point of the visualization.","change-title":"Opens a propmt to change the title of the currently active view."},services:{"":"Other ways to access SNIK.","sparql-endpoint":"Expert interface for the SPARQL Protocol and RDF Query Language endpoint.","rdf-browser":"Browse complete descriptions of resources in the RDF browser."},language:"Language switch, you can choose between English, German and Persian. Ontologies may not or not fully support all available languages.",help:"Common Help Menu, holds e.g. this manual"},"context-menu":{"":"Right click on a node/edge to open the context menu and choose among:","base-mode":{description:"Opens the node in an RDF browser, which shows all its properties and values.",star:{"":"Highlights and expands the node and all its directly connected nodes.",img:"star.png"},"incoming-star":"Highlights and expands the node and all neighbours directly connected via incoming edges.","outgoing-star":"Highlights and expands the node and all neighbours directly connected via outgoing edges.",path:{"":"Shortest Path between a selected source and this node.",img:"star.png"},spiderworm:{"":"The Spider Worm consists of the shortest path between a selected source and this node plus all direct neighbours. Displaying a spiderworm hides all other nodes and edges.",img:"spiderworm.png"},edit:"If you are a domain expert and notice incorrectly modelled facts or connections of a node, feel free to send us an issue.","combine-close-matches":"Merge equivalent classes from different subontologies.","class-use":"Visualize the interplay of role, function and entity type (related to the Meta model).",hide:"Hide the selected item until the view is resetted.","set-path-source":"Set the starting point for path operations.","confirm-link":"Confirm that the automatically generated interlink is correct."},"dev-mode":{"remove-permanently":"Send us an issue to delete the selected item permanently. Also removes it until graph is reloaded.",ontowiki:"Access restricted ontology editing tool.",debug:"Get debug information to the edge/node from the JSON File"},"ext-mode":{doublestar:{"":"The double star is like the spiderworm but shows connected nodes for both source and target, not just the target.",img:"doublestar.png"},starpath:{"":"Creates a path and star (expand) every node along it.",img:"starpath.png"},circlestar:{"":"A star (expansion of the node) using a circular layout. Hides all other nodes.",img:"circlestar.png"},lodlive:"Third party data visualization exploration tool."}}};function Ve(s){const e={};for(const t in s){if(t===""||t==="img")continue;const n=s[t];if(typeof n=="string"){e[t]=n;continue}n[""]&&(e[t]=n[""]),Object.assign(e,Ve(n))}return e}const ye=Ve($t);function Oe(){for(const s in ye){const e=ye[s];if(typeof e!="string"&&console.error("value "+e+" for key "+s+" not a string"),document.getElementById(s))Ee("#"+s,{content:e});else{const n=`[data-i18n="${s}"]`;document.querySelectorAll(n).length>0?Ee(n,{content:e}):c.trace(`tooltip init: found none of #${s} and [data-i18n="${s}"]`)}}}ce.use(it);const Ne={menuItems:[]};class J{constructor(e){b(this,"graph");b(this,"cxtMenus");this.graph=e,c.debug("Register Context Menu."),Ne.menuItems=[...Mt(e),...Pt(e)],e.cy.contextMenus(Ne),this.cxtMenus=[]}static logWrap(e,t){if(!e.onClickFunction||e.onClickFunction.wrapped)return;const n=e.onClickFunction;e.onClickFunction=o=>{c.debug("Context Menu: Operation "+e.content+" on "+t(o)),n(o)},e.onClickFunction.wrapped=!0}static ontoWikiUrl(e){return"https://www.snik.eu/ontowiki/view/?r="+e+"&m="+It(e)}static addTippy(e){e.commands.forEach(t=>{if(t.tippy)return;t.tippy=!0;const n=ye[t.id];!n||(t.contentStyle={"pointer-eve":"all"},t.content=`<img src onerror="tippy('span')"><span data-tippy-content="${n}" style="padding:3em;">${t.content}</span>`)})}}ce.use(rt);const Bt=500;let U;function He(s,e,t=!1){return"layout"+s+e.sort().toString().replace(/[^a-z]/g,"")+!!t}function qe(s){const e=[];for(let t=0;t<s.size();t++){const n=s[t];e.push([n.data(u.ID),n.position()])}return e}function Ie(s){const e={x:0,y:0};for(let t=0;t<s.length;t++){const n=s[t].position();e.x+=n.x,e.y+=n.y}return e.x/=s.length,e.y/=s.length,e}async function T(s,e,t,n=!1,o=!1){if(s.nodes().size()===0)return c.warn("layout.js#run: Graph empty. Nothing to layout."),!1;const i=V("layout");if(n){const p=new Set,v=[],C=s.nodes();for(let S=0;S<C.length;S++){const R=C[S],k=R.data(u.SOURCE);k&&(p.has(k)||(s.add({group:"nodes",data:{id:k,mass:400,type:"virtual"}}),p.add(k)),v.push({group:"edges",data:{source:R.data(u.ID),target:k,springLength:180}}))}c.debug("Separate subontologies checked"),c.debug(`Adding ${v.length} virtual edges.`),s.add(v)}else c.debug("Separate subontologies unchecked");U&&U.stop();let a,r;s.nodes(":selected").size()>1?(a=s.elements(":selected"),r=!0):(a=s.elements(":visible"),r=!1);let l;r&&(l=Ie(a.nodes()));const g=a.size()>Bt&&typeof window!="undefined",w=de(O({},e),{animate:g});U=a.layout(w),U.on("layoutstop",()=>{if(r){const p=Ie(a.nodes());a.nodes().shift({x:l.x-p.x,y:l.y-p.y})}if(i.stop(),t&&n){const p=s.nodes("[type='virtual']");c.debug(`Removing ${p.length} virtual nodes.`),s.remove(p)}if(t&&o){if(typeof localStorage=="undefined")return c.warn("web storage not available, could not write to cache."),!0;const p=qe(s.nodes()),v=He(e.name,t,n);localStorage.setItem(v,JSON.stringify(p)),c.info("Replaced layout cache.")}});const h=U.promiseOn("layoutready");return U.run(),await h,!0}async function Ut(s,e){const t=new Map(e);let n=0,o=0;const a=await T(s,{name:"preset",fit:!0,positions:r=>{let l;return(l=t.get(r.data(u.ID)))?(n++,l):(o++,{x:0,y:0})}});if(o>0||n<qe.length){c.debug(`...${n}/${s.nodes().size()} node positions set. ${e.length-n} superfluous layout positions .`);const r=n/e.length,l=n/s.nodes().size();if(r<m.layoutCacheMinPrecision)return c.warn(`Precision of ${r} less than minimal required precision of ${m.layoutCacheMinPrecision}.`),!1;if(l<m.layoutCacheMinRecall)return c.warn(`Recall of ${l} less than minimal required of recall of ${m.layoutCacheMinRecall}.`),!1}else c.debug("...layout applied with 100% overlap.");return n===0?!1:a}async function We(s,e,t,n=!1){if(typeof localStorage=="undefined")return c.error("Web storage not available, could not access browser-based cache."),T(s,e,t,n,!1);const o=He(e.name,t,n),i=localStorage.getItem(o);if(i)try{const a=JSON.parse(i);if(c.debug(`Loaded layout from cache, applying ${a.length} positions...`),await Ut(s,a))return!0;c.warn("Could not apply layout to active graph, recalculating layout...")}catch(a){c.warn("Could not load cache item, recalculating layout...",a)}else c.warn("Layout not in cache, recalculating layout...");return T(s,e,t,n,!0)}function Ft(s){const e=s.data("springLength");return e||800}const G={name:"euler",springLength:s=>Ft(s),animate:!0,refresh:50,maxSimulationTime:4e4,maxIterations:500,timeStep:80,randomize:!0,movementThreshold:1,fit:!1,mass:s=>s.data("mass")?s.data("mass"):40},ae={name:"euler",springLength:40,animate:!1,maxSimulationTime:4e4,maxIterations:500,timeStep:80,refresh:50,randomize:!1,movementThreshold:1,fit:!1,mass:40},je={name:"cose",animate:!0,refresh:50,numIter:500,initialTemp:1e3,nestingFactor:1.01,randomize:!1,fit:!0};function Ke(){const s={settings:{selectionEnabled:!0},content:[{type:"stack",content:[]}]},e=new ct(s);return e.on("selectionChanged ",t=>{c.info("SELECTION CHANGED"),c.info(t)}),e.on("stackCreated",function(t){e.selectItem(t);const n=L("goldenlayout-header"),o=document.importNode(n.content,!0);t.header.controlsContainer.prepend(o),t.on("activeContentItemChanged",()=>{e.selectItem(t)});const i=()=>t.getActiveContentItem().config.componentState,a=()=>i().cy,r=t.header.controlsContainer[0],l=()=>d.mainView.state.graph.menu.separateSubs()&&!i().graph.starMode,g=[[".plussign",()=>{a().zoom(a().zoom()*1.2)}],[".minussign",()=>{a().zoom(a().zoom()/1.2)}],[".addsign",()=>{new d}],[".recalculatesign",()=>{T(a(),G,s.defaultSubOntologies,l(),!0)}],[".tightlayoutsign",()=>{T(a(),ae,s.defaultSubOntologies,l(),!0)}],[".compoundlayoutsign",()=>{T(a(),je,s.defaultSubOntologies,!1,!0)}]];for(const w of g)r.querySelector(w[0]).addEventListener("click",w[1])}),e.init(),e}let ge=0,me=null,P=Ke();function Je(s,e){const t=[];if(s.type==="component"&&s.componentName!=="Gesamtmodell")return t.push(s),t;for(const n of s.contentItems)t.push(...Je(n));return t}const N=class{constructor(e=!0,t){b(this,"initialized");b(this,"state");b(this,"cyContainer",document.createElement("div"));b(this,"element");b(this,"cxtMenu");t=t!=null?t:ge++===0?"Gesamtmodell":"Teilmodell "+(ge-1),this.state={title:t,name:"unnamed"};const n={title:t,type:"component",componentName:t,componentState:this.state,isClosable:N.mainView!==null},o=this;N.mainView!==null&&N.partViews.add(this),P.registerComponent(t,function(r){o.element=r.getElement()[0],r.getElement()[0].appendChild(o.cyContainer),r.on("destroy",()=>{N.partViews.delete(o)})}),P.root.contentItems[0].addChild(n);const i=new y(o.cyContainer),a=i.cy;this.state.graph=i,this.state.cy=a,this.initialized=e?this.fill():Promise.resolve(),this.initialized.then(()=>{this.state.graph.invert(Ye().options.dayMode),this.cxtMenu=new J(this.state.graph)})}static views(){return[this.mainView,...this.partViews]}static activeState(){var e,t,n;return(n=(t=(e=P.selectedItem)==null?void 0:e.getActiveContentItem())==null?void 0:t.config)==null?void 0:n.componentState}static activeView(){var e;return(e=P.selectedItem)==null?void 0:e.getActiveContentItem()}async fill(){const e=this.state.graph;if(N.mainView===null)N.mainView=this,me=sn(e),await me,c.debug(`Main view ${this.state.name} loaded with ${e.cy.elements().size()} elements.`);else{await me,e.cy.add(N.mainView.state.cy.elements()),c.debug(`Create view ${this.state.title} with ${e.cy.elements().size()} hidden elements copied from ${N.mainView.state.title}.`);const t=e.cy.elements();y.setVisible(t,!1),y.setVisible(t.edgesWith(t),!1),t.removeClass("source"),e.starMode=!0}}static reset(){const e=Je(P.root);for(const t of e)t.remove();N.partViews.clear(),ge=0,P.destroy(),P=Ke()}};let d=N;b(d,"mainView",null),b(d,"partViews",new Set);const Dt=[[`node[${u.SOURCE}='meta']`,"meta","meta"],[`node[${u.SOURCE}='bb']`,"BB","bb"],[`node[${u.SOURCE}='ob']`,"OB","ob"],[`node[${u.SOURCE}='ciox']`,"CioX","ciox"],[`node[${u.SOURCE}='he']`,"HE","he"],[`node[${u.SOURCE}='it']`,"IT","it"],[`node[${u.SOURCE}='it4it']`,"IT4IT","it4it"],[`node[${u.SUBTOP}='${u.SUBTOP_ROLE}']`,"Role","role"],[`node[${u.SUBTOP}='${u.SUBTOP_FUNCTION}']`,"Function","function"],[`node[${u.SUBTOP}='${u.SUBTOP_ENTITY_TYPE}']`,"EntityType","entitytype"],[`node[?${u.INSTANCE}]`,"Show Instances","show-instances"],[`node[!${u.INSTANCE}]`,"Show Non-Instances"],["edge[p='http://www.w3.org/2000/01/rdf-schema#subClassOf']","subClassOf","subclassof"],["edge[p!='http://www.w3.org/2000/01/rdf-schema#subClassOf']","non-subClassOf","non-subclassof"],["edge[p^='http://www.w3.org/2004/02/skos/core#']","inter-ontology-relations","inter-ontology-relations"],["edge[p!^='http://www.w3.org/2004/02/skos/core#']","non-inter-ontology-relations","non-inter-ontology-relations"]],X=[],Z=s=>d.views().map(e=>e.state.cy).forEach(e=>s(e));class Y{constructor(e,t,n){b(this,"selector");b(this,"label");b(this,"checkbox");b(this,"a");b(this,"cssClass");b(this,"visible");this.selector=e;const o=document.createElement("input");o.type="checkbox",this.checkbox=o,o.classList.add("filterbox"),o.autocomplete="off",o.checked=!0,this.label=t,this.a=document.createElement("a"),this.a.classList.add("dropdown-entry"),this.a.appendChild(o),this.a.setAttribute("tabindex","-1"),this.a.addEventListener("keydown",Ue(o)),this.a.appendChild(Fe(o,t,n)),this.cssClass=`filter-${t}`,this.visible=!0,Z(i=>i.elements(this.selector).addClass(this.cssClass)),o.addEventListener("input",()=>this.setVisible(o.checked)),X.push(this)}toString(){return this.label}setVisible(e){if(this.visible===e)return;this.visible=e;const t=X.filter(n=>!n.visible).map(n=>n.selector);if(t.length===0)Z(n=>n.elements().removeClass("filtered")),Z(n=>n.elements().addClass("unfiltered")),c.debug("All filters checked");else{const n=t.reduce((o,i)=>o+","+i);Z(o=>{const i=o.elements(n);i.addClass("filtered"),i.removeClass("unfiltered");const a=o.elements().not(i);a.removeClass("filtered"),a.addClass("unfiltered")}),c.debug("filter "+n+" triggered")}}static addFilterEntries(e,t){for(const n of Dt){const o=new Y(n[0],n[1],n[2]);e.appendChild(o.a),t.push(o.a)}}static toJSON(){const e={};for(const t of X)e[t.label]=t.visible;return e}static fromJSON(e){for(const t of X)t.checkbox.checked=e[t.label],t.visible=e[t.label]}}const zt={version:$};function Ye(){const s={filters:Y.toJSON(),options:re.optionsToJSON()};return Object.assign(s,zt),s}function Gt(s){Y.fromJSON(s.filters),re.optionsFromJSON(s.options)}ce.use(lt);const A=document.createElement("a");document.body.appendChild(A);A.style.display="none";function Se(s,e){const t=JSON.stringify(s),n=new Blob([t],{type:"application/json"}),o=window.URL.createObjectURL(n);A.href=o,A.download=e,A.click(),window.URL.revokeObjectURL(o),c.debug("JSON File saved: "+e)}function Qe(s,e){A.href=s,A.download=e,A.click(),window.URL.revokeObjectURL(s),c.debug("File saved: "+e)}function Vt(s){const e=s.cy.json();delete e.style,Se(e,"snik.json")}function Ht(s){const e={title:d.mainView.state.title,graph:d.mainView.state.cy.json(),options:s};delete e.graph.style;const t={tabs:[],state:Ye(),mainGraph:e};for(const n of d.partViews){const o={title:n.state.title,graph:n.state.cy.json()};delete o.graph.style,t.tabs.push(o)}Se(t,"snik-session.json")}function qt(s){const e={version:$,title:s.state.title,graph:s.state.cy.json()};delete e.graph.style,Se(e,"snik-view.json")}function ee(s,e,t,n){const o={bg:e?"white":"black",full:t,maxWidth:void 0,maxHeight:void 0};n?(o.maxWidth=m.download.image.max.width,o.maxHeight=m.download.image.max.height):t&&(o.maxWidth=m.download.image.standard.width,o.maxHeight=m.download.image.standard.height);const i=s.cy.png(o);Qe(i,"snik.png")}function xe(s,e,t=!0){const n={full:t,scale:1,bg:e?"white":"black"},o=s.cy.svg(n),i=new Blob([o],{type:"image/svg+xml;charset=utf-8"}),a=window.URL.createObjectURL(i);Qe(a,"snik.svg")}const _e=new Map,Xe=new Map,te=new Set;async function Re(s,e){const t=`SELECT DISTINCT(?class) ?label
  FROM <http://www.snik.eu/ontology/${s}>
  {
    ?class  ?p ?o;
            a owl:Class;
            rdfs:label ?label.
    {?class meta:chapter <${e}>.}
    UNION
    {?class meta:chapter/meta:subChapterOf <${e}>.}
    UNION
    {?class meta:chapter/meta:subChapterOf/meta:subChapterOf <${e}>.}
    UNION
    {?class meta:chapter/meta:subChapterOf/meta:subChapterOf/meta:subChapterOf <${e}>.}

    FILTER(LANGMATCHES(LANG(?label),"en"))
  }
  ORDER BY ASC(?class)`,n=await x(t);n.forEach(i=>{Xe.set(i.class.value,i.label.value)});const o=n.map(i=>i.class.value);return _e.set(e,o),new Set(o)}async function Ae(s,e){const t=L("tab:chapter-search-classes");for(;t.rows.length>0;)t.deleteRow(0);const n=(a,r)=>{const g=t.insertRow().insertCell(),w=document.createElement("a");g.appendChild(w),w.innerText=a,w.addEventListener("click",()=>{I.close("chapter-search"),s.resetStyle(),s.presentUris(Array.from(e),r)})};n("Show Only those in Graph",!0),n("Highlight All in Graph",!1);const i=t.insertRow().insertCell();i.innerHTML="&nbsp;";for(const a of e){const l=t.insertRow().insertCell(),g=document.createElement("a");l.appendChild(g),g.innerText=Xe.get(a),g.addEventListener("click",()=>{I.close("chapter-search"),s.presentUri(a)})}}async function Me(s,e){I.show("chapter-search");const t=L("tab:chapter-search-chapters");for(;t.rows.length>0;)t.deleteRow(0);{const r=L("tab:chapter-search-classes");for(;r.rows.length>0;)r.deleteRow(0)}te.clear();const n=t.insertRow().insertCell(),o=document.createElement("a");n.appendChild(o),o.setAttribute("data-i18n","deselect-all"),o.innerText=ze("deselect-all"),o.addEventListener("click",()=>{for(const r of document.getElementsByClassName("chaptersearch-checkbox"))r.checked&&r.click()});const i=`SELECT COUNT(DISTINCT(?c)) AS ?count ?ch
  FROM <http://www.snik.eu/ontology/${e}>
  {
    ?c ?p ?o; a owl:Class.
    ?c meta:chapter/meta:subChapterOf* ?ch.
  } ORDER BY ASC(?ch)`,a=await x(i);for(const r of a){const l=r.ch.value,g=t.insertRow(),w=g.insertCell();w.addEventListener("click",async()=>Ae(s,await Re(e,l)));const h=document.createElement("a");w.appendChild(h),h.innerText=r.ch.value;const p=g.insertCell();p.innerHTML=r.count.value;const v=g.insertCell(),C=document.createElement("input");v.appendChild(C),C.setAttribute("type","checkbox"),C.classList.add("chaptersearch-checkbox"),v.addEventListener("input",async()=>{C.checked?(await Re(e,l),te.add(l)):te.delete(l),Ae(s,new Set([...te].map(S=>_e.get(S)).flat().sort()))})}}function Ce(s,e){const t=s.target.files[0],n=new FileReader;n.onload=()=>e(JSON.parse(n.result)),n.readAsText(t)}function ie(s,e){const t=s.cy;t.elements().remove(),t.json(e),t.elements().addClass("unfiltered");const n=1*s.cy.elements(":visible").size()/s.cy.elements().size(),o=n<.8;c.debug("Load Graph from File: Visible fraction: "+n+" set star mode to "+o),s.cy.nodes(":child").size()>0&&(document.getElementById("combineMatchModeBox").checked=!0),s.starMode=o;const i=t.nodes(":visible");t.center(i),t.fit(i),t.elements().removeClass("highlighted"),t.elements().removeClass("source")}const Wt=s=>e=>{Ce(e,t=>{ie(s,t)})};async function jt(s){!confirm("This will override the current session. Continue?")||Ce(s,async e=>{if(e.state.version!==$&&!confirm(`Your file was saved in version ${e.state.version}, but SNIK Graph has version ${$}, so it may not work properly. Continue anyway?`))return;d.reset();const t=new d(!1),n=[t.initialized];ie(t.state.graph,e.mainGraph.graph),d.activeView().setTitle(e.mainGraph.title);for(let o=0;o<e.tabs.length;o++){const i=new d(!1);n.push(i.initialized),ie(i.state.graph,e.tabs[o].graph),d.activeView().setTitle(e.tabs[o].title)}await Promise.all(n),Gt(e.state)})}function Kt(s){Ce(s,e=>{if(e.version!==$&&!confirm(`Your file was saved in version ${e.version}, but SNIK Graph has version ${$}, so it may not work properly. Continue anyway?`))return;const t=new d(!1);ie(t.state.graph,e.graph),d.activeView().setTitle(e.title)})}function Pe(s,e,t,n,o){const i=document.createElement("a");o.push(i),i.classList.add("dropdown-entry"),i.setAttribute("tabindex","-1"),s.appendChild(i);const a=document.createElement("input");a.type="file",a.style.display="none",i.appendChild(a);const r=document.createElement("span");r.innerText=t,r.setAttribute("data-i18n",e),i.appendChild(r),i.addEventListener("click",()=>a.click()),a.addEventListener("change",n)}function Jt(s,e,t){Pe(e,"load-view","Load Partial Graph into Session",Kt,t),Pe(e,"load-session","Load Session",jt,t)}let re=null;class j{constructor(){b(this,"separateSubsBox");b(this,"dayModeBox");if(re)throw Error("Menu already exists.");document.body.addEventListener("click",j.closeListener),this.showCloseMatches=this.showCloseMatches.bind(this),this.addMenu(),re=this}separateSubs(){return this.separateSubsBox.checked}setLanguage(e){if(!!Lt(e)){Ot();for(const t of d.views()){const n=t.state.graph.cy.elements();t.state.graph.cy.remove(n),n.restore()}}}static about(){window.alert("SNIK Graph version "+$)}static visualizationFeedback(){W(Ct,"",`Please type your issue here:



!!Please do not delete the following text, because its the log for developers!!

`,c.logs)}showCloseMatches(){c.debug("show close matches start");const t=d.activeState().graph.cy.elements(".unfiltered").not(".hidden").connectedEdges(".unfiltered").filter('[pl="closeMatch"]');y.setVisible(t,!0),y.setVisible(t.connectedNodes(".unfiltered"),!0),c.debug("show close matches end")}menuData(){return[{label:"File",i18n:"file",id:"file",entries:[[async()=>{await Be(this.graph.cy,[]),K(async()=>await We(this.graph.cy,G,m.defaultSubOntologies,this.separateSubs()))},"Load from SPARQL Endpoint","load-sparql"],[()=>Ht(this.optionsToJSON()),"Save Session","save-session"],[()=>Vt(d.activeState().graph),"Save the full SNIK Graph","save-snik-graph"],[()=>qt(d.activeView()),"Save currently active view (partial graph)","save-view"],[()=>{K(()=>T(d.activeState().cy,G,m.defaultSubOntologies,this.separateSubs(),!0))},"Recalculate Layout and Replace in Browser Cache","recalculate-layout-replace"],[()=>ee(d.activeState().graph,this.dayModeBox.checked,!1,!1),"Save PNG Image of Current View","save-image-current-view"],[()=>ee(d.activeState().graph,this.dayModeBox.checked,!0,!1),"Save PNG Image of Whole Graph","save-image-whole-graph"],[()=>ee(d.activeState().graph,this.dayModeBox.checked,!1,!0),"Save PNG Image of Current View (high res)","save-image-current-view-high-res"],[()=>ee(d.activeState().graph,this.dayModeBox.checked,!0,!0),"Save PNG Image of Whole Graph (high res)","save-image-whole-graph-high-res"],[()=>xe(d.activeState().graph,this.dayModeBox.checked,!1),"Save SVG Image of Current View"],[()=>xe(d.activeState().graph,this.dayModeBox.checked,!0),"Save SVG Image of Whole Graph"]]},{label:"Filter",i18n:"filter",id:"filter",entries:[]},{label:"Options",i18n:"options",id:"options",entries:[]},{label:"Layout",i18n:"layout",entries:[[this.showCloseMatches,"show close matches","show-close-matches"],[()=>{T(d.activeState().graph.cy,G,m.defaultSubOntologies,this.separateSubs()&&!d.activeState().graph.starMode,!0)},"recalculate layout","recalculate-layout","ctrl+alt+l"],[()=>{T(d.activeState().graph.cy,ae,m.defaultSubOntologies,this.separateSubs()&&!d.activeState().graph.starMode,!1)},"tight layout","tight-layout","ctrl+alt+t"],[()=>{T(d.activeState().graph.cy,je,m.defaultSubOntologies,this.separateSubs()&&!d.activeState().graph.starMode,!1)},"compound layout","compound-layout","ctrl+alt+c"],[()=>d.activeState().graph.moveAllMatches(0),"move matches on top of each other","move-match-on-top"],[()=>d.activeState().graph.moveAllMatches(100),"move matches nearby","move-match-nearby"],[()=>{Me(d.activeState().graph,"bb")},"BB chapter search","bb-chapter-search"],[()=>{Me(d.activeState().graph,"ob")},"OB chapter search","ob-chapter-search"],[d.activeState().graph.subOntologyConnectivity,"subontology connectivity","subontology-connectivity"],[d.mainView.state.graph.resetStyle,"reset main view","reset-view","ctrl+alt+r"],[()=>{d.activeView().setTitle(prompt("Rename: "+d.activeView().config.title)||d.activeView().config.title),d.activeState().title=d.activeView().config.title},"change title of active View","change-title"]]},{label:"Services",i18n:"services",entries:[["http://www.snik.eu/sparql","SPARQL Endpoint","sparql-endpoint"],["http://www.snik.eu/ontology","RDF Browser","rdf-browser"]]},{label:"Language",i18n:"language",entries:[[()=>this.setLanguage(u.LABEL_ENGLISH),"english","english"],[()=>this.setLanguage(u.LABEL_GERMAN),"german","german"],[()=>this.setLanguage(u.LABEL_PERSIAN),"persian","persian"]]},{label:"Help",i18n:"help",entries:[["html/manual.html","Manual"],["html/layoutHelp.html","Layout Help"],["doc/index.html","Developer Documentation"],["html/troubleshooting.html","Troubleshooting"],["html/contribute.html","Contribute"],["https://www.snik.eu/","Project Homepage"],["https://www.snik.eu/public/SNIK_Metamodell_V8.svg","SNIK Meta Model"],[j.about,"About SNIK Graph"],["https://github.com/snikproject/ontology/issues","Submit Feedback about the Ontology"],[j.visualizationFeedback,"Submit Feedback about the Visualization"]]}]}addOptions(e){const t=L("options-menu-content"),n=["separateSubs","cumulativeSearch","grid","combineMatchMode","dayMode"];this.optionBoxes={};for(const o of n){c.trace("Add option "+o);const i=document.createElement("a");e.push(i),t.appendChild(i),i.setAttribute("tabindex","-1"),i.classList.add("dropdown-entry");const a=document.createElement("input");this.optionBoxes[o]=a,i.appendChild(a),a.type="checkbox",a.autocomplete="off",this[o+"Box"]=a,a.id=o+"Box",i.addEventListener("keydown",Ue(a)),i.appendChild(Fe(a,ze(o),o))}this.separateSubsBox.addEventListener("change",()=>{c.debug("Set separate Subontologies to "+this.separateSubsBox.checked)}),this.dayModeBox.addEventListener("change",()=>{for(const o of d.views())o.state.graph.invert(this.dayModeBox.checked);c.debug("Set dayMode to "+this.dayModeBox.checked)}),this.gridBox.addEventListener("change",()=>{document.body.classList[this.gridBox.checked?"add":"remove"]("grid"),c.debug("set gridBox to "+this.gridBox.checked)}),m.activeOptions.includes("day")&&this.dayModeBox.click(),this.cumulativeSearchBox.addEventListener("change",()=>{c.debug("Set cumulative search to "+this.cumulativeSearchBox.checked)}),this.combineMatchModeBox.addEventListener("change",()=>{c.debug("Set combine match mode to "+this.combineMatchModeBox.checked),setTimeout(()=>{d.views().map(o=>o.state.graph).forEach(o=>o.combineMatch(this.combineMatchModeBox.checked))},10)})}addMenu(){console.groupCollapsed("Add menu");const e=document.createElement("ul");L("top").prepend(e),e.classList.add("dropdown-bar"),e.setAttribute("tabindex","0");const t=this.menuData(),n=[],o=[];for(let i=0;i<t.length;i++){const a=t[i],r=document.createElement("li");r.setAttribute("tabindex","-1"),e.appendChild(r);const l=document.createElement("span");n.push(l),r.appendChild(l),l.classList.add("dropdown-menu"),l.innerText=a.label,l.setAttribute("data-i18n",a.i18n),l.setAttribute("tabindex","-1");const g=document.createElement("div");r.appendChild(g),g.classList.add("dropdown-content"),g.setAttribute("tabindex","-1"),a.id&&(g.id=a.id+"-menu-content"),l.addEventListener("click",()=>{for(const h of document.getElementsByClassName("dropdown-content"))g!==h&&h.classList.remove("show");g.classList.toggle("show")});const w=[];o.push(w);for(const h of a.entries){const p=document.createElement("a");switch(w.push(p),p.classList.add("dropdown-entry"),p.setAttribute("data-i18n",h[2]),p.setAttribute("tabindex","-1"),g.appendChild(p),p.innerHTML=h[1],typeof h[0]){case"string":{p.href=h[0],p.target="_blank";break}case"function":{p.addEventListener("click",h[0]);const v=h[3];v&&(dt(v,h[0]),p.innerHTML=p.innerHTML+` (${v.toUpperCase()})`);break}default:c.error("unknown menu entry action type: "+typeof h[0])}}l.addEventListener("keydown",h=>{switch(h.key){case"ArrowLeft":n[(i-1+n.length)%n.length].focus(),n[(i-1+n.length)%n.length].click();break;case"ArrowRight":n[(i+1)%n.length].focus(),n[(i+1)%n.length].click();break;case"ArrowDown":w[0].focus();break}})}Jt(d.activeState().graph,L("file-menu-content"),o[0]),c.debug("fileLoadEntries added"),Y.addFilterEntries(L("filter-menu-content"),o[1]),c.debug("filter entries added"),this.addOptions(o[2]);for(let i=0;i<o.length;i++){const a=o[i];for(let r=0;r<a.length;r++)a[r].addEventListener("keydown",l=>{switch(l.key){case"ArrowLeft":n[(i-1+n.length)%n.length].focus(),n[(i-1+n.length)%n.length].click();break;case"ArrowRight":n[(i+1)%n.length].focus(),n[(i+1)%n.length].click();break;case"ArrowUp":a[(r-1+a.length)%a.length].focus();break;case"ArrowDown":a[(r+1)%a.length].focus();break}})}c.debug("Menu added"),console.groupEnd()}static closeListener(e){if(e&&e.target&&e.target.matches&&!e.target.matches(".dropdown-entry")&&!e.target.matches(".dropdown-menu")&&!e.target.matches("input.filterbox")){const t=document.getElementsByClassName("dropdown-content");Array.from(t).forEach(n=>n.classList.remove("show"))}}optionsToJSON(){const e=["separateSubs","cumulativeSearch","grid","combineMatchMode","dayMode"],t={};for(const n of e)t[n]=this.optionBoxes[n].checked;return t}optionsFromJSON(e){const t=this.optionsToJSON();for(const[n,o]of Object.entries(e))t[n]!==o&&this.optionBoxes[n].click()}}let be=null;const Yt={shouldSort:!0,tokenize:!0,threshold:.25,maxPatternLength:40,minMatchCharLength:3,matchAllTokens:!0,location:0,ignoreLocation:!0,distance:100,id:"uri",keys:[{name:"l",weight:.7},{name:"def",weight:.3}]};async function Qt(){typeof window!="undefined"&&console.groupCollapsed("Create Fuse.js index");const s=V("Create Fuse search index");c.debug("Create Fuse Search Index with searchCloseMatch = "+m.searchCloseMatch);const e=`select
  ?c as ?uri
  group_concat(distinct(str(?l));separator="|") as ?l
  group_concat(distinct(str(?def));separator="|") as ?def
  from <${m.sparql.graph}>
  {
    {
     {?c a owl:Class.} UNION {?c a [a owl:Class]}
     ?c rdfs:label ?l.
    }
    UNION {?c skos:altLabel ?l.}
    UNION {?c skos:closeMatch|^skos:closeMatch ?cm. ?cm rdfs:label|skos:altLabel ?l.}
    OPTIONAL {?c skos:definition ?def.}
  }`,t=await x(e),n=[];for(const o of t){const i=o.uri.value.replace(/.*\//,""),a={uri:o.uri.value,l:[...o.l.value.split("|"),i]};n.push(a),a.l=[...new Set(a.l)],o.def.value&&(a.def=o.def.value)}return be=new ut(n,Yt),s.stop(n.length+" items"),typeof window!="undefined"&&console.groupEnd(),n}async function _t(s){return be||await Qt(),be.search(s)}const fe=100;class Xt{constructor(e){b(this,"resultNodes",[]);e.addEventListener("submit",t=>{t.preventDefault(),K(()=>this.showSearch(t.target.children.query.value))}),c.debug("search initialized")}showSearchResults(e,t){this.resultNodes=[];const n=L("tab:search-results");for(;n.rows.length>0;)n.deleteRow(0);if(t.length===0)return L("h2:search-results").innerHTML=`No Search Results for "${e}"`,!1;if(t.length===1)return I.close("search-results"),d.activeState().graph.presentUri(t[0]),!0;t.length===fe?L("h2:search-results").innerHTML=`First ${fe} Search Results for "${e}"`:L("h2:search-results").innerHTML=`${t.length} Search Results for "${e}"`;const o={};t.forEach(r=>{const l=d.activeState().cy.getElementById(r)[0];l?(o[r]=0,l.hasClass("hidden")&&!l.hasClass("filtered")?o[r]=1:l.hasClass("filtered")&&(o[r]=2)):o[r]=3});const i=new Set;t.sort((r,l)=>o[r]-o[l]),t.forEach(r=>{const l=n.insertRow(),g=l.insertCell(),w=document.createElement("input");w.type="checkbox",g.appendChild(w),g.addEventListener("change",C=>{i[C.target.checked?"add":"remove"](r)});const h=l.insertCell(),p=l.insertCell();window.presentUri=d.activeState().graph.presentUri,h.innerHTML=`<a class="search-class${o[r]}" href="javascript:MicroModal.close('search-results');window.presentUri('${r}');void(0)">
          ${r.replace(ne.PREFIX,"")}</a>`;const v=`<a class="search-class${o[r]}" href="${r}" target="_blank">Description</a>`;p.innerHTML=v});const a=n.insertRow(0);a.insertCell();{const r=a.insertCell();r.innerHTML="<a href='#'>Highlight All</a>",r.addEventListener("click",l=>{I.close("search-results"),d.activeState().graph.presentUris(t),l.preventDefault()})}{const r=a.insertCell();r.innerHTML="<a href='#'>Highlight Selected</a>",r.addEventListener("click",l=>{I.close("search-results"),d.activeState().graph.presentUris([...i]),l.preventDefault()})}return!0}async search(e){const n=`select distinct(?s) { {?s a owl:Class.} UNION {?s a rdf:Property.}
        {?s rdfs:label ?l.} UNION {?s skos:altLabel ?l.}	filter(regex(lcase(replace(str(?l),"[ -]","")),lcase("${e.replace(/[\x22\x27\x5C\x0A\x0D -]/g,"")}"))) } order by asc(strlen(str(?l))) limit ${fe}`;return c.debug(n),(await x(n)).map(i=>i.s.value)}async showSearch(e){I.show("search-results");const n=(await _t(e)).map(o=>o.item.uri);return this.showSearchResults(e,n),!1}}function Zt(){const s=new ht({duration:1e4,types:[{type:"warn",backgroundColor:"orange",icon:{className:"material-icons",tagName:"i",text:"warning"}},{type:"info",backgroundColor:"green",icon:{className:"material-icons",tagName:"i",text:"info"}},{type:"debug",backgroundColor:"blue",icon:{className:"material-icons",tagName:"i",text:"debug"}},{type:"trace",backgroundColor:"darkgray",icon:{className:"material-icons",tagName:"i",text:"trace"}}]});c.setLevel(m.logLevelConsole);const e=["error","warn","info","debug","trace"],t={silent:0,error:1,warn:2,info:3,debug:4,trace:5};for(const n of e){const o=c[n];c[n]=i=>{o(i),t[n]<=t[m.logLevelMemory]&&(c.logs||(c.logs=[]),c.logs.push(i)),t[n]<=t[m.logLevelDisplay]&&s.open({type:n,message:i})}}}function en(s){const e=[];for(let a=0;a<2+2;a++){const r=new ue;r.domElement.style.cssText=`position:absolute;top:0px;right:${100*a}px;`,document.body.appendChild(r.dom),e.push(r)}const n=e[2].addPanel(new ue.Panel("Nodes","#ff8","#221")),o=e[2+1].addPanel(new ue.Panel("Edges","#f8f","#212"));for(let a=0;a<e.length;a++)e[a].showPanel(Math.min(a,e.length-2));let i=0;requestAnimationFrame(function a(){for(const r of e)r.update();i=(i+1)%30,i===0&&(n.update(s.nodes(":visible").size()),o.update(s.edges(":visible").size())),requestAnimationFrame(a)})}function tn(){const s=new URL(window.location.href),e={endpoint:m.sparql.endpoint,instances:m.sparql.instances};return Object.assign(e,de(O(O({empty:s.searchParams.get("empty")!==null,clazz:s.searchParams.get("class"),jsonUrl:s.searchParams.get("json")},s.searchParams.get("sparql")&&{endpoint:s.searchParams.get("sparql")}),s.searchParams.get("instances")!==null&&{instances:s.searchParams.get("instances")===""||s.searchParams.get("instances")==="true"}),{virtual:s.searchParams.get("virtual")!==null,rdfGraph:s.searchParams.get("graph"),sub:s.searchParams.get("sub"),benchmark:s.searchParams.get("benchmark")!==null}))}async function nn(s,e){try{if(e.benchmark&&en(s.cy),e.empty){c.info('Parameter "empty" detected. Skip loading and display file load prompt.');const n=document.getElementById("loadarea"),o=document.createElement("center");n.appendChild(o),o.innerHTML+=`<button id="load-button" style="font-size:10vh;margin-top:20vh">Datei Laden
      <input id="load-input" type="file" style="display:none"></input>
      </button>`;const i=document.getElementById("load-input"),a=document.getElementById("load-button");a.onclick=()=>{i.click()},i.addEventListener("change",r=>{n.removeChild(o),s.cy.resize(),Wt(s)(r)});return}if(e.jsonUrl){c.info("Loading from JSON URL "+e.jsonUrl);const n=await(await fetch(e.jsonUrl)).json();s.cy.add(n),T(s.cy,ae);return}c.debug("Loading from SPARQL Endpoint "+e.endpoint),m.sparql.endpoint=e.endpoint;const t=[];if(e.endpoint===ne.ENDPOINT){let n=[];e.sub&&(n=e.sub.split(",")),n.length===0&&(n=[...m.helperGraphs,...m.defaultSubOntologies]),t.push(...n.map(o=>ne.PREFIX+o))}else e.rdfGraph&&(t.push(e.rdfGraph),m.sparql.graph=e.rdfGraph);if(console.debug(`Loading graph with${e.instances?"":"out"} instances.`),await Be(s.cy,t,e.instances,e.virtual),s.instancesLoaded=e.instances,e.endpoint===ne.ENDPOINT){await We(s.cy,G,m.defaultSubOntologies,!1),y.setVisible(s.cy.elements(),!1);const n=s.cy.nodes("node[id='http://www.snik.eu/ontology/bb/ChiefInformationOfficer']");s.showStar(n),await T(s.cy,ae),s.cy.elements().unselect(),s.cy.center(n),s.cy.fit(s.cy.elements(":visible")),y.setVisible(n,!0),s.starMode=!0}else await T(s.cy,G);e.clazz&&(c.info(`Parameter "class" detected. Centering on URI ${e.clazz}.`),setTimeout(()=>s.presentUri(e.clazz),300))}catch(t){c.error(t),c.error("Error initializing SNIK Graph "+t)}}async function sn(s){await K(async()=>{const e=tn();await nn(s,e),s.menu=new j,new Xt(L("search")),Oe()}),Oe()}const q=[];function on(){document.documentElement.addEventListener("keydown",s=>{const e=s.target;if(!e||e.nodeName!=="BODY")return;const t=d.activeState();if(!!t){if((s.code==="Delete"||s.code==="Backspace")&&t.cy.remove(":selected"),s.code==="KeyS"||s.code==="KeyC"){const n=t.cy.nodes(":selected");if(n.size()===0)return;q.length=0,q.push(...n.map(o=>o.id())),c.debug(`Copied ${q.length} elements from ${t.name}.`),c.info("Partial graph copied!")}if(s.code==="KeyP"||s.code==="KeyV"){t.cy.startBatch(),t.cy.elements().unselect();const n=t.graph.getElementsByIds(q);y.setVisible(n,!0),t.cy.endBatch();const o=t.cy.nodes(".unfiltered").not(".hidden"),i=n.edgesWith(o),a=n.union(i);y.setVisible(a,!0),a.select(),t.cy.fit(t.cy.elements(".unfiltered").not(".hidden")),c.debug(`Pasted ${q.length} elements into ${t.name}.`),c.info("Partial graph inserted!")}}})}async function an(){if(window.mainCalled){c.warn("main() is called multiple times for unknown reasons. Ignoring.");return}window.mainCalled=!0,console.groupCollapsed("Initializing"),console.time("Initializing"),Zt(),on(),I.init({openTrigger:"data-custom-open"});for(let s=0;s<m.multiview.initialTabs;s++)await new d().initialized;console.timeEnd("Initializing"),console.groupEnd()}document.addEventListener("DOMContentLoaded",an);
