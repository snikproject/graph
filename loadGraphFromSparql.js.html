<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>loadGraphFromSparql.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-browser_contextmenu.html">browser/contextmenu</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenu.html#.addTippy">addTippy</a></li><li data-type='method'><a href="module-browser_contextmenu.html#populate">populate</a></li><li data-type='method'><a href="module-browser_contextmenu.html#reset">reset</a></li></ul></li><li><a href="module-browser_contextmenuEdges.html">browser/contextmenuEdges</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseLimesMenu">baseLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseMenu">baseMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devLimesMenu">devLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devMenu">devMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#baseCommands">baseCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#devCommands">devCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#edgeLabel">edgeLabel</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#limesCommands">limesCommands</a></li></ul></li><li><a href="module-browser_filter-Filter.html">Filter</a><ul class='methods'><li data-type='method'><a href="module-browser_filter-Filter.html#setVisible">setVisible</a></li><li data-type='method'><a href="module-browser_filter-Filter.html#toString">toString</a></li></ul></li><li><a href="module-browser_menu.Menu.html">Menu</a><ul class='methods'><li data-type='method'><a href="module-browser_menu.Menu.html#.about">about</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#.closeListener">closeListener</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#.visualizationFeedback">visualizationFeedback</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#addMenu">addMenu</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#addOptions">addOptions</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#menuData">menuData</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#optionsFromJSON">optionsFromJSON</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#optionsToJSON">optionsToJSON</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#separateSubs">separateSubs</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#setLanguage">setLanguage</a></li><li data-type='method'><a href="module-browser_menu.Menu.html#showCloseMatches">showCloseMatches</a></li></ul></li><li><a href="module-browser_search.html">browser/search</a><ul class='methods'><li data-type='method'><a href="module-browser_search.html#search">search</a></li><li data-type='method'><a href="module-browser_search.html#showSearch">showSearch</a></li><li data-type='method'><a href="module-browser_search.html#showSearchResults">showSearchResults</a></li></ul></li><li><a href="module-browser_view.View.html">View</a><ul class='methods'><li data-type='method'><a href="module-browser_view.View.html#fill">fill</a></li></ul></li><li><a href="module-graph.Graph.html">Graph</a><ul class='methods'><li data-type='method'><a href="module-graph.Graph.html#.setVisible">setVisible</a></li><li data-type='method'><a href="module-graph.Graph.html#.starStyle">starStyle</a></li><li data-type='method'><a href="module-graph.Graph.html#assimilate">assimilate</a></li><li data-type='method'><a href="module-graph.Graph.html#combineMatch">combineMatch</a></li><li data-type='method'><a href="module-graph.Graph.html#createRemoveIssue">createRemoveIssue</a></li><li data-type='method'><a href="module-graph.Graph.html#cumulativeSearch">cumulativeSearch</a></li><li data-type='method'><a href="module-graph.Graph.html#getElementsByIds">getElementsByIds</a></li><li data-type='method'><a href="module-graph.Graph.html#getSource">getSource</a></li><li data-type='method'><a href="module-graph.Graph.html#invert">invert</a></li><li data-type='method'><a href="module-graph.Graph.html#moveAllMatches">moveAllMatches</a></li><li data-type='method'><a href="module-graph.Graph.html#moveNodes">moveNodes</a></li><li data-type='method'><a href="module-graph.Graph.html#multiplex">multiplex</a></li><li data-type='method'><a href="module-graph.Graph.html#newGraph">newGraph</a></li><li data-type='method'><a href="module-graph.Graph.html#presentUri">presentUri</a></li><li data-type='method'><a href="module-graph.Graph.html#presentUris">presentUris</a></li><li data-type='method'><a href="module-graph.Graph.html#resetStyle">resetStyle</a></li><li data-type='method'><a href="module-graph.Graph.html#setSource">setSource</a></li><li data-type='method'><a href="module-graph.Graph.html#showCloseMatch">showCloseMatch</a></li><li data-type='method'><a href="module-graph.Graph.html#showDoubleStar">showDoubleStar</a></li><li data-type='method'><a href="module-graph.Graph.html#showPath">showPath</a></li><li data-type='method'><a href="module-graph.Graph.html#showStar">showStar</a></li><li data-type='method'><a href="module-graph.Graph.html#showStarMultiplexed">showStarMultiplexed</a></li><li data-type='method'><a href="module-graph.Graph.html#showStarMultiplexedNew">showStarMultiplexedNew</a></li><li data-type='method'><a href="module-graph.Graph.html#showWorm">showWorm</a></li><li data-type='method'><a href="module-graph.Graph.html#subOntologyConnectivity">subOntologyConnectivity</a></li></ul></li><li><a href="module-property.Property.html">Property</a></li></ul><h3>Modules</h3><ul><li><a href="config.module_dist.html">dist</a></li><li><a href="module-browser_benchmark.html">browser/benchmark</a><ul class='methods'><li data-type='method'><a href="module-browser_benchmark.html#.addOverlay">addOverlay</a></li></ul></li><li><a href="module-browser_chaptersearch.html">browser/chaptersearch</a><ul class='methods'><li data-type='method'><a href="module-browser_chaptersearch.html#.showChapterSearch">showChapterSearch</a></li><li data-type='method'><a href="module-browser_chaptersearch.html#~getClasses">getClasses</a></li><li data-type='method'><a href="module-browser_chaptersearch.html#~showClasses">showClasses</a></li></ul></li><li><a href="module-browser_classuse.html">browser/classuse</a></li><li><a href="module-browser_colorschemeday.html">browser/colorschemeday</a></li><li><a href="module-browser_colorschemenight.html">browser/colorschemenight</a></li><li><a href="module-browser_contextmenu.html">browser/contextmenu</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenu.html#.addTippy">addTippy</a></li><li data-type='method'><a href="module-browser_contextmenu.html#populate">populate</a></li><li data-type='method'><a href="module-browser_contextmenu.html#reset">reset</a></li></ul></li><li><a href="module-browser_contextmenuEdges.html">browser/contextmenuEdges</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseLimesMenu">baseLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.baseMenu">baseMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devLimesMenu">devLimesMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#.devMenu">devMenu</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#baseCommands">baseCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#devCommands">devCommands</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#edgeLabel">edgeLabel</a></li><li data-type='method'><a href="module-browser_contextmenuEdges.html#limesCommands">limesCommands</a></li></ul></li><li><a href="module-browser_contextmenuNodes.html">browser/contextmenuNodes</a><ul class='methods'><li data-type='method'><a href="module-browser_contextmenuNodes.html#~baseCommands">baseCommands</a></li><li data-type='method'><a href="module-browser_contextmenuNodes.html#~devCommands">devCommands</a></li><li data-type='method'><a href="module-browser_contextmenuNodes.html#~extCommands">extCommands</a></li></ul></li><li><a href="module-browser_filter.html">browser/filter</a><ul class='methods'><li data-type='method'><a href="module-browser_filter.html#.addFilterEntries">addFilterEntries</a></li><li data-type='method'><a href="module-browser_filter.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="module-browser_filter.html#.toJSON">toJSON</a></li></ul></li><li><a href="module-browser_load.html">browser/load</a><ul class='methods'><li data-type='method'><a href="module-browser_load.html#.addFileLoadEntries">addFileLoadEntries</a></li><li data-type='method'><a href="module-browser_load.html#.loadSessionFromJsonFile">loadSessionFromJsonFile</a></li><li data-type='method'><a href="module-browser_load.html#.loadView">loadView</a></li><li data-type='method'><a href="module-browser_load.html#~addLoadEntry">addLoadEntry</a></li><li data-type='method'><a href="module-browser_load.html#~loadGraphFromJson">loadGraphFromJson</a></li><li data-type='method'><a href="module-browser_load.html#~uploadJson">uploadJson</a></li></ul></li><li><a href="module-browser_log.html">browser/log</a></li><li><a href="module-browser_main.html">browser/main</a><ul class='methods'><li data-type='method'><a href="module-browser_main.html#.fillInitialGraph">fillInitialGraph</a></li><li data-type='method'><a href="module-browser_main.html#~applyParams">applyParams</a></li><li data-type='method'><a href="module-browser_main.html#~initKeyListener">initKeyListener</a></li><li data-type='method'><a href="module-browser_main.html#~main">main</a></li><li data-type='method'><a href="module-browser_main.html#~parseParams">parseParams</a></li></ul></li><li><a href="module-browser_menu.html">browser/menu</a></li><li><a href="module-browser_progress.html">browser/progress</a></li><li><a href="module-browser_save.html">browser/save</a><ul class='methods'><li data-type='method'><a href="module-browser_save.html#.saveGraph">saveGraph</a></li><li data-type='method'><a href="module-browser_save.html#.saveJson">saveJson</a></li><li data-type='method'><a href="module-browser_save.html#.savePng">savePng</a></li><li data-type='method'><a href="module-browser_save.html#.saveSession">saveSession</a></li><li data-type='method'><a href="module-browser_save.html#.saveSvg">saveSvg</a></li><li data-type='method'><a href="module-browser_save.html#.saveUrl">saveUrl</a></li><li data-type='method'><a href="module-browser_save.html#.saveView">saveView</a></li><li data-type='method'><a href="module-browser_save.html#~stringify">stringify</a></li></ul></li><li><a href="module-browser_search.html">browser/search</a><ul class='methods'><li data-type='method'><a href="module-browser_search.html#search">search</a></li><li data-type='method'><a href="module-browser_search.html#showSearch">showSearch</a></li><li data-type='method'><a href="module-browser_search.html#showSearchResults">showSearchResults</a></li></ul></li><li><a href="module-browser_state.html">browser/state</a><ul class='methods'><li data-type='method'><a href="module-browser_state.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="module-browser_state.html#.toJSON">toJSON</a></li></ul></li><li><a href="module-browser_style.html">browser/style</a></li><li><a href="module-browser_teststyle.html">browser/teststyle</a></li><li><a href="module-browser_util.html">browser/util</a><ul class='methods'><li data-type='method'><a href="module-browser_util.html#.checkboxClickableDiv">checkboxClickableDiv</a></li><li data-type='method'><a href="module-browser_util.html#.createGitHubIssue">createGitHubIssue</a></li><li data-type='method'><a href="module-browser_util.html#.getElementById">getElementById</a></li></ul></li><li><a href="module-browser_view.html">browser/view</a><ul class='methods'><li data-type='method'><a href="module-browser_view.html#.activeState">activeState</a></li><li data-type='method'><a href="module-browser_view.html#.activeView">activeView</a></li><li data-type='method'><a href="module-browser_view.html#.reset">reset</a></li><li data-type='method'><a href="module-browser_view.html#~traverse">traverse</a></li></ul></li><li><a href="module-browser_viewLayout.html">browser/viewLayout</a><ul class='methods'><li data-type='method'><a href="module-browser_viewLayout.html#.goldenLayout">goldenLayout</a></li></ul></li><li><a href="module-edge.html">edge</a></li><li><a href="module-fuse.html">fuse</a><ul class='methods'><li data-type='method'><a href="module-fuse.html#.createIndex">createIndex</a></li><li data-type='method'><a href="module-fuse.html#.search">search</a></li></ul></li><li><a href="module-graph.html">graph</a></li><li><a href="module-lang_language.html">lang/language</a><ul class='methods'><li data-type='method'><a href="module-lang_language.html#.getIdStrings">getIdStrings</a></li><li data-type='method'><a href="module-lang_language.html#.getLanguage">getLanguage</a></li><li data-type='method'><a href="module-lang_language.html#.getString">getString</a></li><li data-type='method'><a href="module-lang_language.html#.setLanguage">setLanguage</a></li><li data-type='method'><a href="module-lang_language.html#.updateHtml">updateHtml</a></li></ul></li><li><a href="module-layout.html">layout</a><ul class='methods'><li data-type='method'><a href="module-layout.html#.positions">positions</a></li><li data-type='method'><a href="module-layout.html#.presetLayout">presetLayout</a></li><li data-type='method'><a href="module-layout.html#.run">run</a></li><li data-type='method'><a href="module-layout.html#.runCached">runCached</a></li><li data-type='method'><a href="module-layout.html#~center">center</a></li><li data-type='method'><a href="module-layout.html#~springLength">springLength</a></li><li data-type='method'><a href="module-layout.html#~storageName">storageName</a></li></ul></li><li><a href="module-loadGraphFromSparql.html">loadGraphFromSparql</a><ul class='methods'><li data-type='method'><a href="module-loadGraphFromSparql.html#~createClassNodes">createClassNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createEdges">createEdges</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createInstanceNodes">createInstanceNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~createNodes">createNodes</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~parseLabels">parseLabels</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectClasses">selectClasses</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectInstances">selectInstances</a></li><li data-type='method'><a href="module-loadGraphFromSparql.html#~selectTriples">selectTriples</a></li></ul></li><li><a href="module-node.html">node</a></li><li><a href="module-property.html">property</a><ul class='methods'><li data-type='method'><a href="module-property.html#.possible">possible</a></li></ul></li><li><a href="module-rdf.html">rdf</a><ul class='methods'><li data-type='method'><a href="module-rdf.html#.long">long</a></li><li data-type='method'><a href="module-rdf.html#.longPrefix">longPrefix</a></li><li data-type='method'><a href="module-rdf.html#.short">short</a></li><li data-type='method'><a href="module-rdf.html#.sub">sub</a></li></ul></li><li><a href="module-sparql.html">sparql</a><ul class='methods'><li data-type='method'><a href="module-sparql.html#.ask">ask</a></li><li data-type='method'><a href="module-sparql.html#.describe">describe</a></li><li data-type='method'><a href="module-sparql.html#.select">select</a></li></ul></li><li><a href="module-string.html">string</a><ul class='methods'><li data-type='method'><a href="module-string.html#.abbrv">abbrv</a></li></ul></li><li><a href="module-timer.html">timer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#browserCheckNonTranspiled">browserCheckNonTranspiled</a></li><li><a href="global.html#browserCheckTranspiled">browserCheckTranspiled</a></li><li><a href="global.html#flatten">flatten</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#logWrap">logWrap</a></li><li><a href="global.html#menuDefaults">menuDefaults</a></li><li><a href="global.html#sayswho">sayswho</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">loadGraphFromSparql.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
Loads the graph from the SNIK SPARQL endpoint. No layouting. May use caching.
@module */
import * as sparql from "./sparql.js";
import timer from "./timer.js";
import config from "./config.js";

/**
 * Query for classes from the endpoint
 * @param  {string} from SPARQL from clause
 * @return {Promise&lt;JSON>}      SPARQL JSON result
 */
async function selectClasses(from)
{
  const sparqlClassesTimer = timer("sparql-classes");

  const classQuerySimple =
  `
  PREFIX ov: &lt;http://open.vocab.org/terms/>
  SELECT ?c
  GROUP_CONCAT(distinct(CONCAT(?l,"@",lang(?l)));separator="|") as ?l
  ?src
  ${from}
  {
    ?c a owl:Class.
    OPTIONAL {?c rdfs:label ?l.}
    OPTIONAL {?src ov:defines ?c.}
  }
  `;

  const classQuerySnik =
  `
  PREFIX ov: &lt;http://open.vocab.org/terms/>
  PREFIX meta: &lt;http://www.snik.eu/ontology/meta/>
  SELECT DISTINCT(?c)
  GROUP_CONCAT(DISTINCT(CONCAT(?l,"@",lang(?l)));separator="|") AS ?l
  SAMPLE(?st) AS ?st
  ?src
  SAMPLE(?inst) AS ?inst
  ${from}
  {
    ?c a owl:Class.
    OPTIONAL {?src ov:defines ?c.}
    OPTIONAL {?c meta:subTopClass ?st.}
    OPTIONAL {?c rdfs:label ?l.}
    OPTIONAL {?inst a ?c.}
  }`;

  const classQuery = config.sparql.endpoint.includes("snik.eu/sparql")?classQuerySnik:classQuerySimple;
  const json = await sparql.select(classQuery);
  sparqlClassesTimer.stop(json.length+" classes");
  return json;
}

/** Parse "|"-separated labels with language tag into the SNIK graph label structure.
@param {string} s a string containing "|"-separated parts
@return {object} an object containing different language labels keyed by language tag */
function parseLabels(s)
{
  const labels = s.split("|");
  const l = {};
  for(const label of labels)
  {
    const [lex,tag] = label.split("@");
    if(!lex.trim()) {continue;}
    {if(!l[tag]) {l[tag]=[];}}
    l[tag].push(lex);
  }
  return l;
}

/**
 *  Creates cytoscape nodes for the classes
 * @param  {string} from a SPARQL FROM clause defining where to load the classes from
 * @return {Promise&lt;Array.&lt;cytoscape.ElementDefinition>>} nodes representing the classes
 */
async function createClassNodes(from)
{
  const json = await selectClasses(from);

  /** @type{cytoscape.ElementDefinition[]} */
  const nodes = [];
  const sources = new Set();
  for(let i=0;i&lt;json.length;i++)
  {
    let source;
    if (json[i].src)
    {
      source = json[i].src.value;
      if(source.includes("http://www.snik.eu/ontology/")) {source=source.replace("http://www.snik.eu/ontology/","");} // abbreviate snik
      sources.add(source);
    }
    nodes.push(
      {
        group: "nodes",
        data: {
          id: json[i].c.value,
          l: parseLabels(json[i].l.value),
          ...(json[i].st &amp;&amp; {st: json[i].st.value.replace("http://www.snik.eu/ontology/meta/","").substring(0,1)}),
          ...(source &amp;&amp; {source: source}),
          ...(json[i].inst &amp;&amp; {inst: true}), // has at least one instance
        },
      });
  }

  const colors = ["rgb(30,152,255)","rgb(255,173,30)","rgb(80,255,250)","rgb(150,255,120)","rgb(204, 0, 204)","rgb(255, 255, 0)"];
  let count = 0;
  for(const source of sources)
  {
    if(!config.color.has(source))
    {
      config.color.set(source,colors[count]);
      count = (count+1) % colors.length;
    }
  }

  log.debug(json.length+" Nodes loaded from SPARQL");
  return nodes;
}

/** Query for instances from the endpoint
* @param  {string} from a SPARQL FROM clause defining where to load the instances from
 @return {Promise&lt;JSON>}      SPARQL JSON result */
async function selectInstances(from)
{
  const sparqlInstancesTimer = timer("sparql-classes");
  const instanceQuery =
  `SELECT
  DISTINCT(?i)
  GROUP_CONCAT(DISTINCT(CONCAT(?l,"@",lang(?l)));separator="|") AS ?l
  ${from}
  {
    ?i a [a owl:Class].
    OPTIONAL {?i rdfs:label ?l.}
  }
  `;
  const json = await sparql.select(instanceQuery);
  sparqlInstancesTimer.stop(json.length+" instances");
  return json;
}

/** Create cytoscape nodes for the instances.
* @param  {string} from a SPARQL FROM clause defining where to load the instances from
 @return {Promise&lt;Array&lt;object>>} cytoscape nodes for the instances */
async function createInstanceNodes(from)
{
  const json = await selectInstances(from);
  /** @type{cytoscape.ElementDefinition[]} */
  const nodes = [];
  for(let i=0;i&lt;json.length;i++)
  {
    nodes.push(
      {
        group: "nodes",
        data:
        {
          id: json[i].i.value,
          l: parseLabels(json[i].l.value),
          instance: true,
        },
      });
  }
  return nodes;
}

/**
   * Query for triples between resources in the SPARQL endpoint
   * @param  {string} from      SPARQL from clause
   * @param  {string} fromNamed SPARQL from named clause
   * @param  {boolean} instances whether to load instances as well
   * @param  {boolean} virtual   whether to select virtual triples from domain and range statements
   * @return {Promise&lt;JSON>}           SPARQL query result object
   */
async function selectTriples(from, fromNamed, instances, virtual)
{
  const sparqlPropertiesTimer = timer("sparql-properties");
  const tripleQuerySimple =
    `
    select  ?c ?p ?d
    ${from}
    {
      {?c ?p ?d.} ${virtual?" UNION {?p rdfs:domain ?c; rdfs:range ?d.}":""}
      {?c a owl:Class.} ${instances?" UNION {?c a [a owl:Class]}":""}
      {?d a owl:Class.} ${instances?" UNION {?d a [a owl:Class]}":""}
    }`;
    // the optional part should be a union
  const tripleQuerySnik =
    `select  ?c ?p ?d ?g (MIN(?ax) as ?ax)
    ${from}
    ${fromNamed}
    {
      graph ?g {?c ?p ?d.}
      filter(?g!=sniko:)
      {?c a owl:Class.} ${instances?" UNION {?c a [a owl:Class]}":""}
      {?d a owl:Class.} ${instances?" UNION {?d a [a owl:Class]}":""}
      filter(?p!=meta:subTopClass)
      OPTIONAL
      {
        ?ax a owl:Axiom;
        owl:annotatedSource ?c;
        owl:annotatedProperty ?p;
        owl:annotatedTarget ?d.
      }
    }`;
  const tripleQuery = config.sparql.endpoint.includes("snik.eu/sparql")?tripleQuerySnik:tripleQuerySimple;
  const json = await sparql.select(tripleQuery);
  sparqlPropertiesTimer.stop(json.length+" properties");
  return json;
}

/**  Creates cytoscape edges for the resources in the SPARQL endpoint
* @param  {string} from      SPARQL from clause
* @param  {string} fromNamed SPARQL from named clause
* @param  {boolean} instances whether to load instances as well
* @param  {boolean} virtual   whether to select virtual triples from domain and range statements
* @return {Promise&lt;JSON>}           SPARQL query result object
*/
async function createEdges(from, fromNamed, instances, virtual)
{
  const json = await selectTriples(from, fromNamed, instances, virtual);
  const edges = [];
  for(let i=0;i&lt;json.length;i++)
  {
    edges.push(
      {
        group: "edges",
        data: {
          source: json[i].c.value,
          target: json[i].d.value,
          id: i,
          p: json[i].p.value,
          pl: json[i].p.value.replace(/.*[#/]/,""),
          ...(json[i].g &amp;&amp; {g: json[i].g.value}), // don't add null/undefined values, see https://stackoverflow.com/a/40560953/398963
          ...(json[i].ax &amp;&amp; {ax: json[i].ax.value}), // in case of virtual triples: the URI of the axiom
        },
        //position: { x: 200, y: 200 }
      });
  }
  log.debug(json.length+" Edges loaded from SPARQL");
  return edges;
}

/**
 * Create cytoscape nodes for classes and optionally also instances.
 * @param  {string} from      a SPARQL from clause
 * @param  {boolean} instances whether to load instances in addition to the classes
 * @return {Promise&lt;Array>} an array of nodes
 */
async function createNodes(from, instances)
{
  if(!instances) {return createClassNodes(from);}
  const [classNodes,instanceNodes] = await Promise.all([createClassNodes(from),createInstanceNodes(from)]);
  return classNodes.concat(instanceNodes);
}

/** Clears the given graph and loads a set of subontologies. Data from RDF helper graphs is loaded as well, such as virtual triples.
  * @param{cytoscape.Core} cy the cytoscape graph to clear and to load the data into
  * @param{string[]} graphs subontologies to load.
  * @param  {boolean} instances whether to load instances as well
  * @param  {boolean} virtual   whether to select virtual triples from domain and range statements
  * @return {Promise&lt;void>} nothing
  @example
  loadGraphFromSparql(cy,new Set(["meta","bb"]))
  */
export default async function loadGraphFromSparql(cy,graphs,instances, virtual)
{
  log.debug(`Loading graph from endpoint ${config.sparql.endpoint} with graphs ${graphs}.`);
  const from = graphs.map(g=>`FROM &lt;${g}>`).reduce((a,b)=>a+"\n"+b,"");
  const fromNamed = from.replace(/FROM/g,"FROM NAMED");

  const [nodes,edges] = await Promise.all([createNodes(from,instances),createEdges(from, fromNamed, instances, virtual)]);
  cy.elements().remove();
  cy.add(nodes);
  cy.add(edges); // will throw an error if any edge refers to a node not contained in the nodes loaded before
  cy.elements().addClass("unfiltered");
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon May 03 2021 12:12:06 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
